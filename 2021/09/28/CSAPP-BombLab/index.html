<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Bomb Lab操作系统：linux 调试工具：gdb 文章分为实验前准备、复习、拆炸弹三个模块。读者可以自取所需。">
<meta property="og:type" content="article">
<meta property="og:title" content="BombLab">
<meta property="og:url" content="http://example.com/2021/09/28/CSAPP-BombLab/index.html">
<meta property="og:site_name" content="Memory Dot">
<meta property="og:description" content="Bomb Lab操作系统：linux 调试工具：gdb 文章分为实验前准备、复习、拆炸弹三个模块。读者可以自取所需。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-09-28T09:09:47.000Z">
<meta property="article:modified_time" content="2021-10-08T15:58:13.491Z">
<meta property="article:author" content="Huang Jinhong">
<meta property="article:tag" content="c">
<meta property="article:tag" content="csapp_lab">
<meta property="article:tag" content="assembly">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2021/09/28/CSAPP-BombLab/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>BombLab | Memory Dot</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Memory Dot</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/09/28/CSAPP-BombLab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Huang Jinhong">
      <meta itemprop="description" content="“我们来到这世上是为的是看太阳”">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Memory Dot">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          BombLab
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-28 17:09:47" itemprop="dateCreated datePublished" datetime="2021-09-28T17:09:47+08:00">2021-09-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-10-08 23:58:13" itemprop="dateModified" datetime="2021-10-08T23:58:13+08:00">2021-10-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/csapp-lab/" itemprop="url" rel="index"><span itemprop="name">csapp lab</span></a>
                </span>
            </span>

          
            <span id="/2021/09/28/CSAPP-BombLab/" class="post-meta-item leancloud_visitors" data-flag-title="BombLab" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/09/28/CSAPP-BombLab/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/09/28/CSAPP-BombLab/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Bomb-Lab"><a href="#Bomb-Lab" class="headerlink" title="Bomb Lab"></a>Bomb Lab</h1><p>操作系统：<strong>linux</strong></p>
<p>调试工具：<strong>gdb</strong></p>
<p>文章分为<strong>实验前准备</strong>、<strong>复习</strong>、<strong>拆炸弹</strong>三个模块。读者可以自取所需。</p>
<span id="more"></span> 


<h2 id="实验前准备"><a href="#实验前准备" class="headerlink" title="实验前准备"></a><strong>实验前准备</strong></h2><p>实验由<code>phase_1 ~ phase_6</code>组成，共6个阶段，<br>我们需要分别<strong>输入6个字符串密码</strong>，以便解除<strong>Dr. Evil</strong>的炸弹，<br><strong>但只要有1个字符串输错，炸弹就会爆炸</strong>。</p>
<p>那么如何知道6个正确的字符串呢？<br>我们需要分别查看<code>phase_1 ~ phase_6</code>的汇编代码，<br>而炸弹就存放在其中，我们要根据汇编代码小心地避开炸弹，分析出正确的字符串即可。<br>而分析需要用到<strong>学习的汇编知识</strong>、<strong>常用的gdb指令</strong>以及<strong>linux终端指令</strong>。<br>需要用到的<strong>linux终端指令</strong>：<br><strong>别忘了先进入文件地址中</strong></p>
<ul>
<li><p><code>objdump -d bomb &gt; assembly.s </code><br>反编译出<code>bomb.c</code>的汇编代码，并存放在<code>assembly.s</code>中（assembly.s是自己命名的）</p>
</li>
<li><p><code>gdb 文件名</code><br>用gdb调试工具打开某个文件<br>eg. <code>gdb bomb</code> <strong>用gdb调试工具打开bomb.c文件</strong><br>而<strong>我们就是要用gdb调试工具打开bomb.c文件后做实验</strong></p>
</li>
</ul>
<p>常用gdb指令：<br><strong>gdb指令必须用gdb调试工具打开文件后才能调用</strong></p>
<ul>
<li><p><code>run</code> （可简写为：<code>r</code>）<br><strong>运行文件</strong>。</p>
</li>
<li><p><code>quit</code> （可简写为：<code>q</code>）<br><strong>停止运行，跳出gdb调试工具</strong></p>
</li>
<li><p><code>break 函数名</code> （可简写为：<code>b 函数名</code>）<br>在某个函数处打断点，以便之后用disas展示这个函数的汇编代码。<br>eg. <code>b phase_1</code>    <strong>在phase_1函数打断点</strong></p>
</li>
<li><p><code>disas 函数名 </code><br>展示这个函数的汇编代码（但必须先打断点）<br>eg. <code>disas phase_1</code>  <strong>展示phase_1的汇编代码</strong></p>
</li>
<li><p><code>x/s 明码或者寄存器</code><br>用以访问明码或者寄存器对应内容<br>eg1. <code>x/s 0x40139b</code>  <strong>访问0x40139b对应内容</strong><br>eg2. <code>x/s $rsi</code>      <strong>访问%rsi对应内容</strong></p>
</li>
</ul>
</br>

<h2 id="复习"><a href="#复习" class="headerlink" title="复习"></a><strong>复习</strong></h2><ul>
<li><p><code>ZF</code><br>zero flag 零标志位</p>
</li>
<li><p><code>test</code><br>进行位级与操作，若结果为0，返回<code>ZF = 1</code>；若结果非0，返回<code>ZF = 0</code>，但不改变两个数的值。同时，需要<strong>特殊注意</strong>的是，可以<strong>对同一个寄存器使用test指令</strong>，例如<code>test   %eax,%eax</code>。</p>
</li>
<li><p><code>je</code><br>根据ZF的值判断是否跳转，当<code>ZF = 1</code>才跳转。</p>
</li>
<li><p><code>jne</code><br>根据ZF的值判断是否跳转，当<code>ZF = 0</code>才跳转。</p>
</li>
<li><p>当<strong>寄存器为空</strong>时，其值为<code>0</code></p>
</li>
<li><p><code>%rdi</code><br>系统往往要把一个值赋给%rdi后，才能当作入参（即输入的参数）</p>
</li>
<li><p><code>register</code><br><strong>注意</strong>：汇编代码为了<strong>优化</strong>常常使用<strong>同一个系列的<code>register</code>表示同一个变量</strong><br>例如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov  $<span class="number">0x2</span>,%rax</span><br><span class="line">sub  $<span class="number">0x1</span>,%eax #此时，%eax = %rax = <span class="number">2</span>，该行执行%eax -= <span class="number">1</span>即%eax = <span class="number">2</span> - <span class="number">1</span></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>register(64bits)</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>%rax</td>
<td>存放返回值</td>
</tr>
<tr>
<td>%rbx</td>
<td>被调用者保存（存放<strong>被调用者的地址</strong>，可以是<strong>函数地址</strong>，也可以是<strong>其它地址</strong>，callee save）</td>
</tr>
<tr>
<td>%rcx</td>
<td>第4个参数（存储参数，可以是<strong>数字字符参数</strong>，也可以是<strong>地址参数</strong>）</td>
</tr>
<tr>
<td>%rdx</td>
<td>第3个参数</td>
</tr>
<tr>
<td>%rsi</td>
<td>第2个参数</td>
</tr>
<tr>
<td>%rdi</td>
<td>第1个参数（经常作<strong>入参</strong>使用）</td>
</tr>
<tr>
<td>%rbp</td>
<td>被调用者保存</td>
</tr>
<tr>
<td>%rsp</td>
<td>栈指针（用以开辟栈空间，注意入参的<strong>先进后出</strong>）</td>
</tr>
<tr>
<td>%r8</td>
<td>第5个参数</td>
</tr>
<tr>
<td>%r9</td>
<td>第6个参数</td>
</tr>
<tr>
<td>%10</td>
<td>调用者保存（存放<strong>调用者函数的地址</strong>，caller save）</td>
</tr>
<tr>
<td>%r11</td>
<td>调用者保存</td>
</tr>
<tr>
<td>%r12</td>
<td>被调用者保存</td>
</tr>
<tr>
<td>%r13</td>
<td>被调用者保存</td>
</tr>
<tr>
<td>%r14</td>
<td>被调用者保存</td>
</tr>
<tr>
<td>%r15</td>
<td>被调用者保存</td>
</tr>
</tbody></table>
</li>
<li><p>优化<br>有些看似毫无作用的汇编代码，其实是在做<em>优化</em>。</p>
</li>
<li><p><code>lea   S,D</code>        （即<code>D &lt;-- S</code>，等价于赋值算式<code>D = S</code>）<br>不是读取数据，<strong>是加载有效地址</strong>，<strong>但和<code>mov</code>指令效果相同</strong>，常用于<strong>执行简洁的算术操作</strong>。</p>
</li>
<li><p><code>sub   S,D</code>        （即<code>D &lt;-- D - S</code>，等价于赋值算式<code>D -= S</code>）<br>减法，D - S后赋值给D。 </p>
</li>
<li><p><code>sar   S,D</code>        （即<code>D &lt;-- D &gt;&gt; S</code>，等价于赋值算式<code>D &gt;&gt;= S</code>）<br><strong>算术右移，补符号位（sign）</strong>，D &gt;&gt; S后赋值给D。注意：<strong>若<code>sar   D</code>，则默认是算术右移<code>1</code>位</strong>。</p>
</li>
<li><p><code>shr   S,D</code>        （即<code>D &lt;-- D &gt;&gt; S</code>，等价于赋值算式<code>D &gt;&gt;= S</code>）<br>**算术右移，补<code>0</code>**，D &gt;&gt; S后赋值给D。</p>
</li>
<li><p><code>jbe</code>    （**<code>jump&lt;=</code><strong>）<br>j：jump；</strong>b：below（小于）**；e：equal。反着用，S2 &lt;= S1</p>
</li>
<li><p><code>jle</code>    （**<code>jump&lt;=</code><strong>）<br>j：jump；</strong>l：less（小于）**；e：equal</p>
</li>
<li><p><code>jge</code>    （**<code>jump&lt;=</code><strong>）<br>j：jump；</strong>g：great（大于）**；e：equal</p>
</li>
<li><p><code>jg</code>    （**<code>jump&gt;</code><strong>）<br>j：jump；</strong>g：great（大于）**</p>
</li>
<li><p><code>ja</code>    （**<code>jump&gt;</code><strong>）<br>j：jump；</strong>a：above（大于）**</p>
</li>
<li><p><code>cmp   S1,S2</code>    （即**<code>S2 - S1</code>**）<br>根据<code>S2 - S1</code>得出的对应的<code>ZF、SF、CF、OF</code></p>
</li>
</ul>
<h2 id="拆炸弹"><a href="#拆炸弹" class="headerlink" title="拆炸弹"></a><strong>拆炸弹</strong></h2><p>在<strong>正式拆炸弹之前</strong>需要注意到一点，我们输入的字符串都是放入到<code>%rdi</code>当中的。<br>（其实一般情况下，输入也是放到<code>%rdi</code>的）<br>也就是说，在每个<code>phase</code>调用时，默认<code>%rdi</code>这个寄存器存放着输入的字符串。<br>如何得到这点的呢？是通过分析<code>main</code>函数的汇编代码得出的。<br></br></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># main part 146 ~ 310</span></span><br><span class="line"> <span class="number">0x0000000000400e32</span> &lt;+<span class="number">146</span>&gt;:	callq  <span class="number">0x40149e</span> &lt;read_line&gt; </span><br><span class="line"> <span class="number">0x0000000000400e37</span> &lt;+<span class="number">151</span>&gt;:	mov    %rax,%rdi <span class="meta"># input store %rdi</span></span><br><span class="line"> <span class="number">0x0000000000400e3a</span> &lt;+<span class="number">154</span>&gt;:	callq  <span class="number">0x400ee0</span> &lt;phase_1&gt;</span><br><span class="line"> <span class="number">0x0000000000400e3f</span> &lt;+<span class="number">159</span>&gt;:	callq  <span class="number">0x4015c4</span> &lt;phase_defused&gt;</span><br><span class="line"> <span class="number">0x0000000000400e44</span> &lt;+<span class="number">164</span>&gt;:	mov    $<span class="number">0x4023a8</span>,%edi</span><br><span class="line"> <span class="number">0x0000000000400e49</span> &lt;+<span class="number">169</span>&gt;:	callq  <span class="number">0x400b10</span> &lt;<span class="built_in">puts</span>@plt&gt;</span><br><span class="line"> <span class="number">0x0000000000400e4e</span> &lt;+<span class="number">174</span>&gt;:	callq  <span class="number">0x40149e</span> &lt;read_line&gt;</span><br><span class="line"> <span class="number">0x0000000000400e53</span> &lt;+<span class="number">179</span>&gt;:	mov    %rax,%rdi <span class="meta"># input store %rdi</span></span><br><span class="line"> <span class="number">0x0000000000400e56</span> &lt;+<span class="number">182</span>&gt;:	callq  <span class="number">0x400efc</span> &lt;phase_2&gt;</span><br><span class="line"> <span class="number">0x0000000000400e5b</span> &lt;+<span class="number">187</span>&gt;:	callq  <span class="number">0x4015c4</span> &lt;phase_defused&gt;</span><br><span class="line"> <span class="number">0x0000000000400e60</span> &lt;+<span class="number">192</span>&gt;:	mov    $<span class="number">0x4022ed</span>,%edi</span><br><span class="line"> <span class="number">0x0000000000400e65</span> &lt;+<span class="number">197</span>&gt;:	callq  <span class="number">0x400b10</span> &lt;<span class="built_in">puts</span>@plt&gt;</span><br><span class="line"> <span class="number">0x0000000000400e6a</span> &lt;+<span class="number">202</span>&gt;:	callq  <span class="number">0x40149e</span> &lt;read_line&gt;</span><br><span class="line"> <span class="number">0x0000000000400e6f</span> &lt;+<span class="number">207</span>&gt;:	mov    %rax,%rdi <span class="meta"># input store %rdi</span></span><br><span class="line"> <span class="number">0x0000000000400e72</span> &lt;+<span class="number">210</span>&gt;:	callq  <span class="number">0x400f43</span> &lt;phase_3&gt;</span><br><span class="line"> <span class="number">0x0000000000400e77</span> &lt;+<span class="number">215</span>&gt;:	callq  <span class="number">0x4015c4</span> &lt;phase_defused&gt;</span><br><span class="line"> <span class="number">0x0000000000400e7c</span> &lt;+<span class="number">220</span>&gt;:	mov    $<span class="number">0x40230b</span>,%edi</span><br><span class="line"> <span class="number">0x0000000000400e81</span> &lt;+<span class="number">225</span>&gt;:	callq  <span class="number">0x400b10</span> &lt;<span class="built_in">puts</span>@plt&gt;</span><br><span class="line"> <span class="number">0x0000000000400e86</span> &lt;+<span class="number">230</span>&gt;:	callq  <span class="number">0x40149e</span> &lt;read_line&gt;</span><br><span class="line"> <span class="number">0x0000000000400e8b</span> &lt;+<span class="number">235</span>&gt;:	mov    %rax,%rdi <span class="meta"># input store %rdi</span></span><br><span class="line"> <span class="number">0x0000000000400e8e</span> &lt;+<span class="number">238</span>&gt;:	callq  <span class="number">0x40100c</span> &lt;phase_4&gt;</span><br><span class="line"> <span class="number">0x0000000000400e93</span> &lt;+<span class="number">243</span>&gt;:	callq  <span class="number">0x4015c4</span> &lt;phase_defused&gt;</span><br><span class="line"> <span class="number">0x0000000000400e98</span> &lt;+<span class="number">248</span>&gt;:	mov    $<span class="number">0x4023d8</span>,%edi</span><br><span class="line"> <span class="number">0x0000000000400e9d</span> &lt;+<span class="number">253</span>&gt;:	callq  <span class="number">0x400b10</span> &lt;<span class="built_in">puts</span>@plt&gt;</span><br><span class="line"> <span class="number">0x0000000000400ea2</span> &lt;+<span class="number">258</span>&gt;:	callq  <span class="number">0x40149e</span> &lt;read_line&gt;</span><br><span class="line"> <span class="number">0x0000000000400ea7</span> &lt;+<span class="number">263</span>&gt;:	mov    %rax,%rdi <span class="meta"># input store %rdi</span></span><br><span class="line"> <span class="number">0x0000000000400eaa</span> &lt;+<span class="number">266</span>&gt;:	callq  <span class="number">0x401062</span> &lt;phase_5&gt;</span><br><span class="line"> <span class="number">0x0000000000400eaf</span> &lt;+<span class="number">271</span>&gt;:	callq  <span class="number">0x4015c4</span> &lt;phase_defused&gt;</span><br><span class="line"> <span class="number">0x0000000000400eb4</span> &lt;+<span class="number">276</span>&gt;:	mov    $<span class="number">0x40231a</span>,%edi</span><br><span class="line"> <span class="number">0x0000000000400eb9</span> &lt;+<span class="number">281</span>&gt;:	callq  <span class="number">0x400b10</span> &lt;<span class="built_in">puts</span>@plt&gt;</span><br><span class="line"> <span class="number">0x0000000000400ebe</span> &lt;+<span class="number">286</span>&gt;:	callq  <span class="number">0x40149e</span> &lt;read_line&gt;</span><br><span class="line"> <span class="number">0x0000000000400ec3</span> &lt;+<span class="number">291</span>&gt;:	mov    %rax,%rdi <span class="meta"># input store %rdi</span></span><br><span class="line"> <span class="number">0x0000000000400ec6</span> &lt;+<span class="number">294</span>&gt;:	callq  <span class="number">0x4010f4</span> &lt;phase_6&gt;</span><br><span class="line"> <span class="number">0x0000000000400ecb</span> &lt;+<span class="number">299</span>&gt;:	callq  <span class="number">0x4015c4</span> &lt;phase_defused&gt;</span><br><span class="line"> <span class="number">0x0000000000400ed0</span> &lt;+<span class="number">304</span>&gt;:	mov    $<span class="number">0x0</span>,%eax </span><br><span class="line"> <span class="number">0x0000000000400ed5</span> &lt;+<span class="number">309</span>&gt;:	pop    %rbx</span><br><span class="line"> <span class="number">0x0000000000400ed6</span> &lt;+<span class="number">310</span>&gt;:	retq   </span><br></pre></td></tr></table></figure>

<p><strong>分析：</strong><br>我们可以看到，在每个<code>phase</code>调用前，都<code>callq  0x40149e &lt;read_line&gt;</code>，然后<code>mov    %rax,%rdi</code>，这样子会将我们输入的字符串最终存到<code>%rdi</code>中。（我们是把字符串输入到<code>read_line</code>的，而<code>read_line</code>会返回到<code>%rax</code>中，<code>mov</code>操作将<code>%rax</code>存到<code>%rdi</code>。<strong>注意</strong>，<code>%rax</code>往往用来放返回值）</p>
<p>至于<code>read_line</code>的汇编代码我就不分析了，通过名字也可以看出：它是<strong>用来返回我们的输入值的</strong></p>
<p>下面开始分析<code>phase_1 ~ phase_6</code>的汇编代码，<br>得出认为正确的字符串，并逐个解除炸弹</p>
<h3 id="phase-1"><a href="#phase-1" class="headerlink" title="phase_1"></a>phase_1</h3><p>查看<code>phase_1</code>的汇编代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x0000000000400ee0</span> &lt;+<span class="number">0</span>&gt;:  sub    $<span class="number">0x8</span>,%rsp #开辟<span class="number">8</span>个字节的栈空间</span><br><span class="line"><span class="number">0x0000000000400ee4</span> &lt;+<span class="number">4</span>&gt;:  mov    $<span class="number">0x402400</span>,%esi #将立即数$<span class="number">0x402400</span>赋值给%esi</span><br><span class="line"><span class="number">0x0000000000400ee9</span> &lt;+<span class="number">9</span>&gt;:  callq  <span class="number">0x401338</span> &lt;strings_not_equal&gt; #调用函数strings_not_equal</span><br><span class="line"><span class="number">0x0000000000400eee</span> &lt;+<span class="number">14</span>&gt;: test   %eax,%eax #与操作（test），若为eax为<span class="number">0</span>则跳转到phase_1+<span class="number">23</span>；若为eax非<span class="number">0</span>则顺序执行，调用explode_bomb，炸弹爆炸</span><br><span class="line"><span class="number">0x0000000000400ef0</span> &lt;+<span class="number">16</span>&gt;: je     <span class="number">0x400ef7</span> &lt;phase_1+<span class="number">23</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400ef2</span> &lt;+<span class="number">18</span>&gt;: callq  <span class="number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line"><span class="number">0x0000000000400ef7</span> &lt;+<span class="number">23</span>&gt;: add    $<span class="number">0x8</span>,%rsp #释放<span class="number">8</span>个字节的栈空间</span><br><span class="line"><span class="number">0x0000000000400efb</span> &lt;+<span class="number">27</span>&gt;: retq   #返回</span><br></pre></td></tr></table></figure>

<p><strong>分析：</strong><br>重点就是<code>&lt;+14&gt;</code>的test指令，可以看出当<code>%eax</code>为0时才不会爆炸。也就是说函数<code>strings_not_equal</code>的返回值<strong>必须为0</strong>才行，根据名字我们可以猜测，字符串不相等时返回1，字符串相等时返回0。下面查看<code>string_not_equal</code>的汇编代码验证我们的猜测。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">#string_not_equal</span><br><span class="line"> <span class="number">0x0000000000401338</span> &lt;+<span class="number">0</span>&gt;:       push   %r12 #将%r12入栈</span><br><span class="line"> <span class="number">0x000000000040133a</span> &lt;+<span class="number">2</span>&gt;:       push   %rbp #将%rbp入栈</span><br><span class="line"> <span class="number">0x000000000040133b</span> &lt;+<span class="number">3</span>&gt;:       push   %rbx #将%rbx入栈</span><br><span class="line"> <span class="number">0x000000000040133c</span> &lt;+<span class="number">4</span>&gt;:       mov    %rdi,%rbx #将%rdi赋给%rbx，不妨命名为第一参数指针，对应我们输入字符串的地址</span><br><span class="line"> <span class="number">0x000000000040133f</span> &lt;+<span class="number">7</span>&gt;:       mov    %rsi,%rbp #将%rsi赋给%rbp，不妨命名为第二参数指针，对应地址是$<span class="number">0x402400</span></span><br><span class="line"> <span class="number">0x0000000000401342</span> &lt;+<span class="number">10</span>&gt;:	callq  <span class="number">0x40131b</span> &lt;string_length&gt; #调用函数string_length，系统默认%rdi为入参，那么，就会计算第一参数的字符串的长度</span><br><span class="line"> <span class="number">0x0000000000401347</span> &lt;+<span class="number">15</span>&gt;:	mov    %eax,%r12d #将第一参数的字符串长度返回值保存到%r12d</span><br><span class="line"> <span class="number">0x000000000040134a</span> &lt;+<span class="number">18</span>&gt;:	mov    %rbp,%rdi #把第二参数指针赋给%rdi，作为string_length的入参</span><br><span class="line"> <span class="number">0x000000000040134d</span> &lt;+<span class="number">21</span>&gt;:	callq  <span class="number">0x40131b</span> &lt;string_length&gt; #计算第二参数的字符串的长度</span><br><span class="line"> <span class="number">0x0000000000401352</span> &lt;+<span class="number">26</span>&gt;:	mov    $<span class="number">0x1</span>,%edx #将<span class="number">1</span>赋值给%edx，作为strings_not_equal的可能返回结果</span><br><span class="line"> <span class="number">0x0000000000401357</span> &lt;+<span class="number">31</span>&gt;:	cmp    %eax,%r12d #比较第一、第二参数的字符串的长度</span><br><span class="line"> <span class="number">0x000000000040135a</span> &lt;+<span class="number">34</span>&gt;:	jne    <span class="number">0x40139b</span> &lt;strings_not_equal+<span class="number">99</span>&gt; #长度不相等时，跳转到&lt;+<span class="number">99</span>&gt;，最终返回<span class="number">1</span>，炸弹爆炸</span><br><span class="line"> <span class="number">0x000000000040135c</span> &lt;+<span class="number">36</span>&gt;:	<span class="built_in">movzbl</span> (%rbx),%eax #长度相等时，将第一参数的第一个字符串赋给%eax</span><br><span class="line"> <span class="number">0x000000000040135f</span> &lt;+<span class="number">39</span>&gt;:	test   %al,%al #判断%al是否为空即<span class="number">0</span></span><br><span class="line"> <span class="number">0x0000000000401361</span> &lt;+<span class="number">41</span>&gt;:	je     <span class="number">0x401388</span> &lt;strings_not_equal+<span class="number">80</span>&gt; #若%al为空，则跳转到&lt;+<span class="number">80</span>&gt;，最终返回<span class="number">0</span>，炸弹不会爆炸，这段我在优化，会顺序执行</span><br><span class="line"> <span class="number">0x0000000000401363</span> &lt;+<span class="number">43</span>&gt;:	cmp    <span class="number">0x0</span>(%rbp),%al #取%rbp的第一个字符，和%al第一个字符做比较；此时(%rbp)对应$<span class="number">0x402400</span>的第一个字符，%al是对应我们输入的字符串的第一个字符</span><br><span class="line"> <span class="number">0x0000000000401366</span> &lt;+<span class="number">46</span>&gt;:	je     <span class="number">0x401372</span> &lt;strings_not_equal+<span class="number">58</span>&gt; #若相等跳转到&lt;+<span class="number">58</span>&gt;</span><br><span class="line"> <span class="number">0x0000000000401368</span> &lt;+<span class="number">48</span>&gt;:	jmp    <span class="number">0x40138f</span> &lt;strings_not_equal+<span class="number">87</span>&gt; #若不相等跳转到&lt;+<span class="number">87</span>&gt;，最终返回<span class="number">1</span>，炸弹爆炸</span><br><span class="line"> <span class="number">0x000000000040136a</span> &lt;+<span class="number">50</span>&gt;:	cmp    <span class="number">0x0</span>(%rbp),%al #比较第一、第二参数的字符</span><br><span class="line"> <span class="number">0x000000000040136d</span> &lt;+<span class="number">53</span>&gt;:	<span class="built_in">nopl</span>   (%rax) #空操作，为了扩展%eax</span><br><span class="line"> <span class="number">0x0000000000401370</span> &lt;+<span class="number">56</span>&gt;:	jne    <span class="number">0x401396</span> &lt;strings_not_equal+<span class="number">94</span>&gt; #不相等跳转到&lt;+<span class="number">94</span>&gt;，最终返回<span class="number">1</span>，炸弹爆炸</span><br><span class="line"> <span class="number">0x0000000000401372</span> &lt;+<span class="number">58</span>&gt;:	add    $<span class="number">0x1</span>,%rbx #第一参数指针+<span class="number">1</span></span><br><span class="line"> <span class="number">0x0000000000401376</span> &lt;+<span class="number">62</span>&gt;:	add    $<span class="number">0x1</span>,%rbp #第二参数指针+<span class="number">1</span></span><br><span class="line"> <span class="number">0x000000000040137a</span> &lt;+<span class="number">66</span>&gt;:	<span class="built_in">movzbl</span> (%rbx),%eax #零扩展%eax，并将第一参数的字符赋给%eax</span><br><span class="line"> <span class="number">0x000000000040137d</span> &lt;+<span class="number">69</span>&gt;:	test   %al,%al #判断此时的%al是否为空，若空，则顺序执行，跳出循环，最终返回<span class="number">0</span>，炸弹不会爆炸</span><br><span class="line"> <span class="number">0x000000000040137f</span> &lt;+<span class="number">71</span>&gt;:	jne    <span class="number">0x40136a</span> &lt;strings_not_equal+<span class="number">50</span>&gt; #若不空，则继续比对字符</span><br><span class="line"> <span class="number">0x0000000000401381</span> &lt;+<span class="number">73</span>&gt;:	mov    $<span class="number">0x0</span>,%edx</span><br><span class="line"> <span class="number">0x0000000000401386</span> &lt;+<span class="number">78</span>&gt;:	jmp    <span class="number">0x40139b</span> &lt;strings_not_equal+<span class="number">99</span>&gt;</span><br><span class="line"> <span class="number">0x0000000000401388</span> &lt;+<span class="number">80</span>&gt;:	mov    $<span class="number">0x0</span>,%edx</span><br><span class="line"> <span class="number">0x000000000040138d</span> &lt;+<span class="number">85</span>&gt;:	jmp    <span class="number">0x40139b</span> &lt;strings_not_equal+<span class="number">99</span>&gt;</span><br><span class="line"> <span class="number">0x000000000040138f</span> &lt;+<span class="number">87</span>&gt;:	mov    $<span class="number">0x1</span>,%edx</span><br><span class="line"> <span class="number">0x0000000000401394</span> &lt;+<span class="number">92</span>&gt;:	jmp    <span class="number">0x40139b</span> &lt;strings_not_equal+<span class="number">99</span>&gt; </span><br><span class="line"> <span class="number">0x0000000000401396</span> &lt;+<span class="number">94</span>&gt;:	mov    $<span class="number">0x1</span>,%edx</span><br><span class="line"> <span class="number">0x000000000040139b</span> &lt;+<span class="number">99</span>&gt;:	mov    %edx,%eax #将%eax赋值为 <span class="number">0</span>或 <span class="number">1</span>，准备返回</span><br><span class="line"> <span class="number">0x000000000040139d</span> &lt;+<span class="number">101</span>&gt;:	pop    %rbx #出栈</span><br><span class="line"> <span class="number">0x000000000040139e</span> &lt;+<span class="number">102</span>&gt;:	pop    %rbp #出栈</span><br><span class="line"> <span class="number">0x000000000040139f</span> &lt;+<span class="number">103</span>&gt;:	pop    %r12 #出栈</span><br><span class="line"> <span class="number">0x00000000004013a1</span> &lt;+<span class="number">105</span>&gt;:	retq   #返回</span><br></pre></td></tr></table></figure>

<p><strong>分析：</strong><br>通过查看<code>string_not_equal</code>函数的汇编代码，可以找到，<code>string_not_equal</code>函数先是比较了输入字符串和地址<code>0x402400</code>对应的字符长度，再逐个比较字符，最终，字符相同返回<code>0</code>，字符不同返回<code>1</code>。我们可以看到，汇编进行不少优化。例如，如果第一个字符已经是不同的，就不用循环进行更多的操作。</p>
<p><strong>key</strong>：由此可以知道，只要我们输入的字符和地址<code>0x402400</code>对应的字符<strong>相同即可</strong>。那么，我们通过gdb指令<code>x/s 0x402400</code>即可访问<code>0x402400</code>对应的字符。代码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s <span class="number">0x402400</span></span><br><span class="line"><span class="number">0x402400</span>:	<span class="string">&quot;Border relations with Canada have never been better.&quot;</span></span><br></pre></td></tr></table></figure>

<p>那么，只要在运行界面输入<code>Border relations with Canada have never been better.</code>即可。（译为：<em>与加拿大的边境关系从来没有这么好过。</em>）</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入前</span></span><br><span class="line">Welcome to my fiendish little bomb. You have <span class="number">6</span> phases with</span><br><span class="line">which to blow yourself up. Have a nice day!</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入后</span></span><br><span class="line">Welcome to my fiendish little bomb. You have <span class="number">6</span> phases with</span><br><span class="line">which to blow yourself up. Have a nice day!</span><br><span class="line">Border relations with Canada have never been better.</span><br><span class="line">Phase <span class="number">1</span> defused. How about the next one?</span><br></pre></td></tr></table></figure>

<h3 id="phase-2"><a href="#phase-2" class="headerlink" title="phase_2"></a>phase_2</h3><p>我们先查看<code>phase_2</code>的汇编代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x0000000000400efc</span> &lt;+<span class="number">0</span>&gt;:	push   %rbp</span><br><span class="line"><span class="number">0x0000000000400efd</span> &lt;+<span class="number">1</span>&gt;:	push   %rbx</span><br><span class="line"><span class="number">0x0000000000400efe</span> &lt;+<span class="number">2</span>&gt;:	sub    $<span class="number">0x28</span>,%rsp</span><br><span class="line"><span class="number">0x0000000000400f02</span> &lt;+<span class="number">6</span>&gt;:	mov    %rsp,%rsi #将%rsp赋给%rsi</span><br><span class="line"><span class="number">0x0000000000400f05</span> &lt;+<span class="number">9</span>&gt;:	callq  <span class="number">0x40145c</span> &lt;read_six_numbers&gt;</span><br><span class="line"><span class="number">0x0000000000400f0a</span> &lt;+<span class="number">14</span>&gt;:	cmpl   $<span class="number">0x1</span>,(%rsp) #(%rsp)必须是$<span class="number">0x1</span>，否则爆炸</span><br><span class="line"><span class="number">0x0000000000400f0e</span> &lt;+<span class="number">18</span>&gt;:	je     <span class="number">0x400f30</span> &lt;phase_2+<span class="number">52</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400f10</span> &lt;+<span class="number">20</span>&gt;:	callq  <span class="number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line"><span class="number">0x0000000000400f15</span> &lt;+<span class="number">25</span>&gt;:	jmp    <span class="number">0x400f30</span> &lt;phase_2+<span class="number">52</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400f17</span> &lt;+<span class="number">27</span>&gt;:	mov    <span class="number">-0x4</span>(%rbx),%eax</span><br><span class="line"><span class="number">0x0000000000400f1a</span> &lt;+<span class="number">30</span>&gt;:	add    %eax,%eax</span><br><span class="line"><span class="number">0x0000000000400f1c</span> &lt;+<span class="number">32</span>&gt;:	cmp    %eax,(%rbx)</span><br><span class="line"><span class="number">0x0000000000400f1e</span> &lt;+<span class="number">34</span>&gt;:	je     <span class="number">0x400f25</span> &lt;phase_2+<span class="number">41</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400f20</span> &lt;+<span class="number">36</span>&gt;:	callq  <span class="number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line"><span class="number">0x0000000000400f25</span> &lt;+<span class="number">41</span>&gt;:	add    $<span class="number">0x4</span>,%rbx</span><br><span class="line"><span class="number">0x0000000000400f29</span> &lt;+<span class="number">45</span>&gt;:	cmp    %rbp,%rbx</span><br><span class="line"><span class="number">0x0000000000400f2c</span> &lt;+<span class="number">48</span>&gt;:	jne    <span class="number">0x400f17</span> &lt;phase_2+<span class="number">27</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400f2e</span> &lt;+<span class="number">50</span>&gt;:	jmp    <span class="number">0x400f3c</span> &lt;phase_2+<span class="number">64</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400f30</span> &lt;+<span class="number">52</span>&gt;:	lea    <span class="number">0x4</span>(%rsp),%rbx</span><br><span class="line"><span class="number">0x0000000000400f35</span> &lt;+<span class="number">57</span>&gt;:	lea    <span class="number">0x18</span>(%rsp),%rbp</span><br><span class="line"><span class="number">0x0000000000400f3a</span> &lt;+<span class="number">62</span>&gt;:	jmp    <span class="number">0x400f17</span> &lt;phase_2+<span class="number">27</span>&gt; #进入循环</span><br><span class="line"><span class="number">0x0000000000400f3c</span> &lt;+<span class="number">64</span>&gt;:	add    $<span class="number">0x28</span>,%rsp</span><br><span class="line"><span class="number">0x0000000000400f40</span> &lt;+<span class="number">68</span>&gt;:	pop    %rbx</span><br><span class="line"><span class="number">0x0000000000400f41</span> &lt;+<span class="number">69</span>&gt;:	pop    %rbp</span><br><span class="line"><span class="number">0x0000000000400f42</span> &lt;+<span class="number">70</span>&gt;:	retq   </span><br></pre></td></tr></table></figure>
<p><code>callq  0x40145c &lt;read_six_numbers&gt;</code>，我们查看这个函数的汇编代码：<br>（根据名字，我们猜测其作用是读取6个数字）</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x000000000040145c</span> &lt;+<span class="number">0</span>&gt;:	sub    $<span class="number">0x18</span>,%rsp</span><br><span class="line"><span class="number">0x0000000000401460</span> &lt;+<span class="number">4</span>&gt;:	mov    %rsi,%rdx</span><br><span class="line"><span class="number">0x0000000000401463</span> &lt;+<span class="number">7</span>&gt;:	lea    <span class="number">0x4</span>(%rsi),%rcx</span><br><span class="line"><span class="number">0x0000000000401467</span> &lt;+<span class="number">11</span>&gt;:	lea    <span class="number">0x14</span>(%rsi),%rax</span><br><span class="line"><span class="number">0x000000000040146b</span> &lt;+<span class="number">15</span>&gt;:	mov    %rax,<span class="number">0x8</span>(%rsp) #参数寄存器不够使用了，用栈帧</span><br><span class="line"><span class="number">0x0000000000401470</span> &lt;+<span class="number">20</span>&gt;:	lea    <span class="number">0x10</span>(%rsi),%rax</span><br><span class="line"><span class="number">0x0000000000401474</span> &lt;+<span class="number">24</span>&gt;:	mov    %rax,(%rsp)</span><br><span class="line"><span class="number">0x0000000000401478</span> &lt;+<span class="number">28</span>&gt;:	lea    <span class="number">0xc</span>(%rsi),%r9</span><br><span class="line"><span class="number">0x000000000040147c</span> &lt;+<span class="number">32</span>&gt;:	lea    <span class="number">0x8</span>(%rsi),%r8</span><br><span class="line"><span class="number">0x0000000000401480</span> &lt;+<span class="number">36</span>&gt;:	mov    $<span class="number">0x4025c3</span>,%esi</span><br><span class="line"><span class="number">0x0000000000401485</span> &lt;+<span class="number">41</span>&gt;:	mov    $<span class="number">0x0</span>,%eax</span><br><span class="line"><span class="number">0x000000000040148a</span> &lt;+<span class="number">46</span>&gt;:	callq  <span class="number">0x400bf0</span> &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line"><span class="number">0x000000000040148f</span> &lt;+<span class="number">51</span>&gt;:	cmp    $<span class="number">0x5</span>,%eax #即cmp  $<span class="number">0x5</span>,$<span class="number">0x0</span>，用以跳过炸弹</span><br><span class="line"><span class="number">0x0000000000401492</span> &lt;+<span class="number">54</span>&gt;:	jg     <span class="number">0x401499</span> &lt;read_six_numbers+<span class="number">61</span>&gt;</span><br><span class="line"><span class="number">0x0000000000401494</span> &lt;+<span class="number">56</span>&gt;:	callq  <span class="number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line"><span class="number">0x0000000000401499</span> &lt;+<span class="number">61</span>&gt;:	add    $<span class="number">0x18</span>,%rsp</span><br><span class="line"><span class="number">0x000000000040149d</span> &lt;+<span class="number">65</span>&gt;:	retq   </span><br></pre></td></tr></table></figure>

<p><strong>分析：</strong><br>注意到<code>phase_2</code>中<code>&lt;+6&gt;</code>已经将%rsp赋给%rsi，那么，对%rsi进行操作也就是之后对<code>phase_2</code>中的%rsp操作。<br>以下表格是对%rsi操作的展示：</p>
<table>
<thead>
<tr>
<th>%rsi</th>
<th>0x4(%rsi)</th>
<th>0x8(%rsi)</th>
<th>0xc(%rsi)</th>
<th>0x10(%rsi)</th>
<th>0x14(%rsi)</th>
</tr>
</thead>
<tbody><tr>
<td>%rdx</td>
<td>%rcx</td>
<td>%r8</td>
<td>%r9</td>
<td>(%rsp)</td>
<td>0x8(%rsp)</td>
</tr>
</tbody></table>
<p>注意，<code>0x10 = 16D</code>，<code>0x14 = 20D</code>。十进制后缀<code>D</code>，Decimal.</p>
<p>可以看到，这样操作传递了6个地址参数，其地址间隔为<code>4</code>，最后两个因为参数寄存器不够用了，只能用栈帧%rsp。（注意，此处的%rsp是<code>read_six_numbers</code>自己开辟的，原先<code>phase_2</code>的%rsp已经<strong>中断</strong>）<br><code>&lt;+36&gt;</code>处，<code>mov    $0x4025c3,%esi</code>，访问0x4025c3内容：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s <span class="number">0x4025c3</span></span><br><span class="line"><span class="number">0x4025c3</span>:	<span class="string">&quot;%d %d %d %d %d %d&quot;</span></span><br></pre></td></tr></table></figure>
<p>可以知道%eax中存放着格式字符串<br><code>&lt;+46&gt;</code>处，<code>callq  0x400bf0 &lt;__isoc99_sscanf@plt&gt;</code>，函数<code>sscanf</code>是c语言自带的函数，同<code>scanf</code>类似，作用是<strong>读取输入的字符串，并根据指定格式存储到指定地址</strong>。这告诉了我们的输入的字符串，应该是6个整型数字，而且之间用空格隔开。同时，它们存放在上述的6个参数地址中，也就是之后<code>phase_2</code>的%rsp按<code>4</code>递增地址的栈帧中。符合我们的猜测。</p>
<p>我们回到<code>phase_2</code>继续<strong>分析：</strong> 可以知道第一个参数数值<code>(%rsp)</code>必须是<code>1</code>，之后会进入一个循环。我们把这个循环单独拿出来看：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x0000000000400f17</span> &lt;+<span class="number">27</span>&gt;:	mov    <span class="number">-0x4</span>(%rbx),%eax</span><br><span class="line"><span class="number">0x0000000000400f1a</span> &lt;+<span class="number">30</span>&gt;:	add    %eax,%eax #此时的%eax是&lt;+<span class="number">27</span>&gt;处的%eax的两倍</span><br><span class="line"><span class="number">0x0000000000400f1c</span> &lt;+<span class="number">32</span>&gt;:	cmp    %eax,(%rbx) #%eax与(%rbx)须相等，否则爆炸</span><br><span class="line"><span class="number">0x0000000000400f1e</span> &lt;+<span class="number">34</span>&gt;:	je     <span class="number">0x400f25</span> &lt;phase_2+<span class="number">41</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400f20</span> &lt;+<span class="number">36</span>&gt;:	callq  <span class="number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line"><span class="number">0x0000000000400f25</span> &lt;+<span class="number">41</span>&gt;:	add    $<span class="number">0x4</span>,%rbx #%rbx地址+<span class="number">4</span></span><br><span class="line"><span class="number">0x0000000000400f29</span> &lt;+<span class="number">45</span>&gt;:	cmp    %rbp,%rbx #%rbp与%rbx相等时，即都为空时，跳出循环</span><br><span class="line"><span class="number">0x0000000000400f2c</span> &lt;+<span class="number">48</span>&gt;:	jne    <span class="number">0x400f17</span> &lt;phase_2+<span class="number">27</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400f2e</span> &lt;+<span class="number">50</span>&gt;:	jmp    <span class="number">0x400f3c</span> &lt;phase_2+<span class="number">64</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400f30</span> &lt;+<span class="number">52</span>&gt;:	lea    <span class="number">0x4</span>(%rsp),%rbx #用%rbx替代<span class="number">0x4</span>(%rsp)</span><br><span class="line"><span class="number">0x0000000000400f35</span> &lt;+<span class="number">57</span>&gt;:	lea    <span class="number">0x18</span>(%rsp),%rbp #将%rbp置空</span><br><span class="line"><span class="number">0x0000000000400f3a</span> &lt;+<span class="number">62</span>&gt;:	jmp    <span class="number">0x400f17</span> &lt;phase_2+<span class="number">27</span>&gt; </span><br></pre></td></tr></table></figure>

<p>我们已经知道<code>(%rsp) = 1</code>，那么第一次循环中，<code>&lt;+32&gt;</code>处的<code>%eax = 2</code>，故只有<code>(%rbx) = 0x4(%rsp) = 2</code>，才不爆炸；第二次循环中，<code>&lt;+32&gt;</code>处的<code>%eax = 4</code>，故<code>(%rbx) = 0x8(%rsp) = 4</code>；第三次循环中，<code>&lt;+32&gt;</code>处的<code>%eax = 8</code>，故<code>(%rbx) = 0xc(%rsp) = 8</code>，可以看出是<strong>以1为首项，后一项是前一项两倍的递增数列</strong>，共6项，以此类推，有下表。</p>
<table>
<thead>
<tr>
<th>%rsi</th>
<th>0x4(%rsi)</th>
<th>0x8(%rsi)</th>
<th>0xc(%rsi)</th>
<th>0x10(%rsi)</th>
<th>0x14(%rsi)</th>
</tr>
</thead>
<tbody><tr>
<td>%rdx</td>
<td>%rcx</td>
<td>%r8</td>
<td>%r9</td>
<td>(%rsp)</td>
<td>0x8(%rsp)</td>
</tr>
<tr>
<td>(%rsp)</td>
<td>0x4(%rsp)</td>
<td>0x8(%rsp)</td>
<td>0xc(%rsp)</td>
<td>0x10(%rsp)</td>
<td>0x14(%rsp)</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>4</td>
<td>8</td>
<td>16</td>
<td>32</td>
</tr>
</tbody></table>
<p><strong>key：</strong> 由此得知，phase_2该输入的字符串为<code>1 2 4 8 16 32</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入前</span></span><br><span class="line">Phase <span class="number">1</span> defused. How about the next one?</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入后</span></span><br><span class="line">Phase <span class="number">1</span> defused. How about the next one?</span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">4</span> <span class="number">8</span> <span class="number">16</span> <span class="number">32</span></span><br><span class="line">That<span class="number">&#x27;</span>s number <span class="number">2.</span>  Keep going!</span><br></pre></td></tr></table></figure>

<h3 id="phase-3"><a href="#phase-3" class="headerlink" title="phase_3"></a>phase_3</h3><p><code>phase_3</code>的汇编代码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x0000000000400f43</span> &lt;+<span class="number">0</span>&gt;:	sub    $<span class="number">0x18</span>,%rsp</span><br><span class="line"><span class="number">0x0000000000400f47</span> &lt;+<span class="number">4</span>&gt;:	lea    <span class="number">0xc</span>(%rsp),%rcx #第二个参数，栈帧先进后出</span><br><span class="line"><span class="number">0x0000000000400f4c</span> &lt;+<span class="number">9</span>&gt;:	lea    <span class="number">0x8</span>(%rsp),%rdx #第一个参数</span><br><span class="line"><span class="number">0x0000000000400f51</span> &lt;+<span class="number">14</span>&gt;:	mov    $<span class="number">0x4025cf</span>,%esi #字符串格式<span class="string">&quot;%d %d&quot;</span></span><br><span class="line"><span class="number">0x0000000000400f56</span> &lt;+<span class="number">19</span>&gt;:	mov    $<span class="number">0x0</span>,%eax</span><br><span class="line"><span class="number">0x0000000000400f5b</span> &lt;+<span class="number">24</span>&gt;:	callq  <span class="number">0x400bf0</span> &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line"><span class="number">0x0000000000400f60</span> &lt;+<span class="number">29</span>&gt;:	cmp    $<span class="number">0x1</span>,%eax #若 <span class="number">1</span> &gt; %eax，则不会爆炸</span><br><span class="line"><span class="number">0x0000000000400f63</span> &lt;+<span class="number">32</span>&gt;:	jg     <span class="number">0x400f6a</span> &lt;phase_3+<span class="number">39</span>&gt; #大于跳转</span><br><span class="line"><span class="number">0x0000000000400f65</span> &lt;+<span class="number">34</span>&gt;:	callq  <span class="number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line"><span class="number">0x0000000000400f6a</span> &lt;+<span class="number">39</span>&gt;:	cmpl   $<span class="number">0x7</span>,<span class="number">0x8</span>(%rsp) #若<span class="number">7</span> &lt; <span class="number">0x8</span>(%rsp)，则爆炸</span><br><span class="line"><span class="number">0x0000000000400f6f</span> &lt;+<span class="number">44</span>&gt;:	ja     <span class="number">0x400fad</span> &lt;phase_3+<span class="number">106</span>&gt; #小于跳转 </span><br><span class="line"><span class="number">0x0000000000400f71</span> &lt;+<span class="number">46</span>&gt;:	mov    <span class="number">0x8</span>(%rsp),%eax</span><br><span class="line"><span class="number">0x0000000000400f75</span> &lt;+<span class="number">50</span>&gt;:	jmpq   *<span class="number">0x402470</span>(,%rax,<span class="number">8</span>) #*<span class="number">0x402470</span>处地址 + <span class="number">8</span> * %eax</span><br><span class="line"><span class="number">0x0000000000400f7c</span> &lt;+<span class="number">57</span>&gt;:	mov    $<span class="number">0xcf</span>,%eax #将$<span class="number">0xcf</span>赋给%eax，下面同理</span><br><span class="line"><span class="number">0x0000000000400f81</span> &lt;+<span class="number">62</span>&gt;:	jmp    <span class="number">0x400fbe</span> &lt;phase_3+<span class="number">123</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400f83</span> &lt;+<span class="number">64</span>&gt;:	mov    $<span class="number">0x2c3</span>,%eax</span><br><span class="line"><span class="number">0x0000000000400f88</span> &lt;+<span class="number">69</span>&gt;:	jmp    <span class="number">0x400fbe</span> &lt;phase_3+<span class="number">123</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400f8a</span> &lt;+<span class="number">71</span>&gt;:	mov    $<span class="number">0x100</span>,%eax</span><br><span class="line"><span class="number">0x0000000000400f8f</span> &lt;+<span class="number">76</span>&gt;:	jmp    <span class="number">0x400fbe</span> &lt;phase_3+<span class="number">123</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400f91</span> &lt;+<span class="number">78</span>&gt;:	mov    $<span class="number">0x185</span>,%eax</span><br><span class="line"><span class="number">0x0000000000400f96</span> &lt;+<span class="number">83</span>&gt;:	jmp    <span class="number">0x400fbe</span> &lt;phase_3+<span class="number">123</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400f98</span> &lt;+<span class="number">85</span>&gt;:	mov    $<span class="number">0xce</span>,%eax</span><br><span class="line"><span class="number">0x0000000000400f9d</span> &lt;+<span class="number">90</span>&gt;:	jmp    <span class="number">0x400fbe</span> &lt;phase_3+<span class="number">123</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400f9f</span> &lt;+<span class="number">92</span>&gt;:	mov    $<span class="number">0x2aa</span>,%eax</span><br><span class="line"><span class="number">0x0000000000400fa4</span> &lt;+<span class="number">97</span>&gt;:	jmp    <span class="number">0x400fbe</span> &lt;phase_3+<span class="number">123</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400fa6</span> &lt;+<span class="number">99</span>&gt;:	mov    $<span class="number">0x147</span>,%eax</span><br><span class="line"><span class="number">0x0000000000400fab</span> &lt;+<span class="number">104</span>&gt;:	jmp    <span class="number">0x400fbe</span> &lt;phase_3+<span class="number">123</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400fad</span> &lt;+<span class="number">106</span>&gt;:	callq  <span class="number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line"><span class="number">0x0000000000400fb2</span> &lt;+<span class="number">111</span>&gt;:	mov    $<span class="number">0x0</span>,%eax</span><br><span class="line"><span class="number">0x0000000000400fb7</span> &lt;+<span class="number">116</span>&gt;:	jmp    <span class="number">0x400fbe</span> &lt;phase_3+<span class="number">123</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400fb9</span> &lt;+<span class="number">118</span>&gt;:	mov    $<span class="number">0x137</span>,%eax</span><br><span class="line"><span class="number">0x0000000000400fbe</span> &lt;+<span class="number">123</span>&gt;:	cmp    <span class="number">0xc</span>(%rsp),%eax #第二个参数必须和%eax相等</span><br><span class="line"><span class="number">0x0000000000400fc2</span> &lt;+<span class="number">127</span>&gt;:	je     <span class="number">0x400fc9</span> &lt;phase_3+<span class="number">134</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400fc4</span> &lt;+<span class="number">129</span>&gt;:	callq  <span class="number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line"><span class="number">0x0000000000400fc9</span> &lt;+<span class="number">134</span>&gt;:	add    $<span class="number">0x18</span>,%rsp</span><br><span class="line"><span class="number">0x0000000000400fcd</span> &lt;+<span class="number">138</span>&gt;:	retq   </span><br></pre></td></tr></table></figure>
<p><strong>分析：</strong><br>访问<code>0x4025cf</code>，可知字符串格式为<code>&quot;%d %d&quot;</code>，从而得知输入字符串是<strong>两个整数</strong>。根据<code>&lt;+39&gt;: cmpl   $0x7,0x8(%rsp)</code>和<code>&lt;+44&gt;:    ja     0x400fad &lt;phase_3+106&gt;</code>可以知道<code>0x8(%rsp) &lt;= 7</code>。那么，<strong>第一个参数%rdx取值要小于等于7</strong>。<br>根据<code>&lt;+50&gt;:    jmpq   *0x402470(,%rax,8)</code>可以知道，跳转的地址是指针<code>*0x402470</code>的变换，增量为<code>8</code>，此时为<code>0x8(%rsp)</code>即为%eax。<br>下面我们用<code>x/s</code>指令逐个访问，指针地址是递增的，但对应存放的<code>phase_3</code>的地址并不是递增的。到这时，答案已经呼之欲出了。<br>（由此可以知道指针<code>*0x402470</code>指向一个存放<code>phase_3</code>部分地址的字符串。一开始我想的是对<code>phase_3</code>的部分地址直接进行增<code>8</code>操作，没有想到是对指针<code>*0x402470</code>进行增<code>8</code>操作，从而访问不同的<code>phase_3</code>中的地址，耽误了许久）</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s *<span class="number">0x402470</span></span><br><span class="line"><span class="number">0x400f7c</span> &lt;phase_3+<span class="number">57</span>&gt;:	<span class="string">&quot;\270&quot;</span>, &lt;incomplete sequence \<span class="number">317</span>&gt;</span><br><span class="line">(gdb) x/s *(<span class="number">0x402470</span>+<span class="number">8</span>)</span><br><span class="line"><span class="number">0x400fb9</span> &lt;phase_3+<span class="number">118</span>&gt;:	<span class="string">&quot;\270\067\001&quot;</span></span><br><span class="line">(gdb) x/s *(<span class="number">0x402470</span>+<span class="number">16</span>)</span><br><span class="line"><span class="number">0x400f83</span> &lt;phase_3+<span class="number">64</span>&gt;:	<span class="string">&quot;\270\303\002&quot;</span></span><br><span class="line">(gdb) x/s *(<span class="number">0x402470</span>+<span class="number">24</span>)</span><br><span class="line"><span class="number">0x400f8a</span> &lt;phase_3+<span class="number">71</span>&gt;:	<span class="string">&quot;\270&quot;</span></span><br><span class="line">(gdb) x/s *(<span class="number">0x402470</span>+<span class="number">32</span>)</span><br><span class="line"><span class="number">0x400f91</span> &lt;phase_3+<span class="number">78</span>&gt;:	<span class="string">&quot;\270\205\001&quot;</span></span><br><span class="line">(gdb) x/s *(<span class="number">0x402470</span>+<span class="number">40</span>)</span><br><span class="line"><span class="number">0x400f98</span> &lt;phase_3+<span class="number">85</span>&gt;:	<span class="string">&quot;\270&quot;</span>, &lt;incomplete sequence \<span class="number">316</span>&gt;</span><br><span class="line">(gdb) x/s *(<span class="number">0x402470</span>+<span class="number">48</span>)</span><br><span class="line"><span class="number">0x400f9f</span> &lt;phase_3+<span class="number">92</span>&gt;:	<span class="string">&quot;\270\252\002&quot;</span></span><br><span class="line">(gdb) x/s *(<span class="number">0x402470</span>+<span class="number">56</span>)</span><br><span class="line"><span class="number">0x400fa6</span> &lt;phase_3+<span class="number">99</span>&gt;:	<span class="string">&quot;\270G\001&quot;</span></span><br></pre></td></tr></table></figure>
<p>对<code>phase_3</code>继续<strong>分析：</strong><br>根据<code>&lt;+123&gt;:    cmp    0xc(%rsp),%eax</code>和<code>&lt;+127&gt;:    je     0x400fc9 &lt;phase_3+134&gt;</code>知道，第二个参数<code>0xc(%rsp)</code>必须和%eax相同，<strong>此时的%eax根据<code>0x8(%rsp)</code>不同而不同</strong>。</p>
<p><strong>key：</strong><br>整理上述分析可以知道，共有<code>8</code>组答案如下：</p>
<table>
<thead>
<tr>
<th>0x8(%rsp)</th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
</tr>
</thead>
<tbody><tr>
<td>x/s</td>
<td>*0x402470</td>
<td>*(~ +8)</td>
<td>*(~ +16)</td>
<td>*(~ +24)</td>
</tr>
<tr>
<td>&lt;phase_3+n&gt;</td>
<td>+57</td>
<td>+118</td>
<td>+64</td>
<td>+71</td>
</tr>
<tr>
<td>0xc(%rsp) H</td>
<td>0xcf</td>
<td>0x137</td>
<td>0x2c3</td>
<td>0x100</td>
</tr>
<tr>
<td>0xc(%rsp) D</td>
<td>207</td>
<td>311</td>
<td>707</td>
<td>256</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>0x8(%rsp)</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
</tr>
</thead>
<tbody><tr>
<td>x/s</td>
<td>*(~ +32)</td>
<td>*(~ +40)</td>
<td>*(~ +48)</td>
<td>*(~ +56)</td>
</tr>
<tr>
<td>&lt;phase_3+n&gt;</td>
<td>+78</td>
<td>+85</td>
<td>+92</td>
<td>+99</td>
</tr>
<tr>
<td>0xc(%rsp) H</td>
<td>0x185</td>
<td>0xce</td>
<td>0x2aa</td>
<td>0x147</td>
</tr>
<tr>
<td>0xc(%rsp) D</td>
<td>389</td>
<td>206</td>
<td>682</td>
<td>327</td>
</tr>
</tbody></table>
<p>（十六进制后缀，H，hexadecimal；十进制后缀，D，Decimal）</p>
<p>我们选择第8组答案<code>7 327</code>作为输入：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入前</span></span><br><span class="line">That<span class="number">&#x27;</span>s number <span class="number">2.</span>  Keep going!</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入后</span></span><br><span class="line">That<span class="number">&#x27;</span>s number <span class="number">2.</span>  Keep going!</span><br><span class="line"><span class="number">7</span> <span class="number">327</span></span><br><span class="line">Halfway there!</span><br></pre></td></tr></table></figure>

<h3 id="phase-4"><a href="#phase-4" class="headerlink" title="phase_4"></a>phase_4</h3><p><code>phase_4</code>的汇编代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x000000000040100c</span> &lt;+<span class="number">0</span>&gt;:	sub    $<span class="number">0x18</span>,%rsp</span><br><span class="line"><span class="number">0x0000000000401010</span> &lt;+<span class="number">4</span>&gt;:	lea    <span class="number">0xc</span>(%rsp),%rcx #第二个参数，先进后出</span><br><span class="line"><span class="number">0x0000000000401015</span> &lt;+<span class="number">9</span>&gt;:	lea    <span class="number">0x8</span>(%rsp),%rdx #第一个参数，参一</span><br><span class="line"><span class="number">0x000000000040101a</span> &lt;+<span class="number">14</span>&gt;:	mov    $<span class="number">0x4025cf</span>,%esi #格式字符串<span class="string">&quot;%d %d&quot;</span></span><br><span class="line"><span class="number">0x000000000040101f</span> &lt;+<span class="number">19</span>&gt;:	mov    $<span class="number">0x0</span>,%eax</span><br><span class="line"><span class="number">0x0000000000401024</span> &lt;+<span class="number">24</span>&gt;:	callq  <span class="number">0x400bf0</span> &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line"><span class="number">0x0000000000401029</span> &lt;+<span class="number">29</span>&gt;:	cmp    $<span class="number">0x2</span>,%eax #返回值%eax必须为<span class="number">2</span>，否则爆炸</span><br><span class="line"><span class="number">0x000000000040102c</span> &lt;+<span class="number">32</span>&gt;:	jne    <span class="number">0x401035</span> &lt;phase_4+<span class="number">41</span>&gt;</span><br><span class="line"><span class="number">0x000000000040102e</span> &lt;+<span class="number">34</span>&gt;:	cmpl   $<span class="number">0xe</span>,<span class="number">0x8</span>(%rsp) #满足<span class="number">0x8</span>(%rsp) &lt;= <span class="number">0xe</span>，否则爆炸</span><br><span class="line"><span class="number">0x0000000000401033</span> &lt;+<span class="number">39</span>&gt;:	jbe    <span class="number">0x40103a</span> &lt;phase_4+<span class="number">46</span>&gt; #小于等于</span><br><span class="line"><span class="number">0x0000000000401035</span> &lt;+<span class="number">41</span>&gt;:	callq  <span class="number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line"><span class="number">0x000000000040103a</span> &lt;+<span class="number">46</span>&gt;:	mov    $<span class="number">0xe</span>,%edx #作为func4的入参</span><br><span class="line"><span class="number">0x000000000040103f</span> &lt;+<span class="number">51</span>&gt;:	mov    $<span class="number">0x0</span>,%esi #作为func4的入参</span><br><span class="line"><span class="number">0x0000000000401044</span> &lt;+<span class="number">56</span>&gt;:	mov    <span class="number">0x8</span>(%rsp),%edi #将<span class="number">0x8</span>(%rsp)赋给%edi，作为func4的入参</span><br><span class="line"><span class="number">0x0000000000401048</span> &lt;+<span class="number">60</span>&gt;:	callq  <span class="number">0x400fce</span> &lt;func4&gt;</span><br><span class="line"><span class="number">0x000000000040104d</span> &lt;+<span class="number">65</span>&gt;:	test   %eax,%eax #%eax必须为空即<span class="number">0</span>，否则爆炸</span><br><span class="line"><span class="number">0x000000000040104f</span> &lt;+<span class="number">67</span>&gt;:	jne    <span class="number">0x401058</span> &lt;phase_4+<span class="number">76</span>&gt;</span><br><span class="line"><span class="number">0x0000000000401051</span> &lt;+<span class="number">69</span>&gt;:	cmpl   $<span class="number">0x0</span>,<span class="number">0xc</span>(%rsp) #<span class="number">0xc</span>(%rsp)必须为<span class="number">0</span>，否则爆炸</span><br><span class="line"><span class="number">0x0000000000401056</span> &lt;+<span class="number">74</span>&gt;:	je     <span class="number">0x40105d</span> &lt;phase_4+<span class="number">81</span>&gt;</span><br><span class="line"><span class="number">0x0000000000401058</span> &lt;+<span class="number">76</span>&gt;:	callq  <span class="number">0x40143a</span> &lt;explode_bomb&gt;</span><br><span class="line"><span class="number">0x000000000040105d</span> &lt;+<span class="number">81</span>&gt;:	add    $<span class="number">0x18</span>,%rsp</span><br><span class="line"><span class="number">0x0000000000401061</span> &lt;+<span class="number">85</span>&gt;:	retq </span><br></pre></td></tr></table></figure>

<p><strong>分析：</strong>仍旧是<strong>输入两个<code>int</code>参数</strong>，根据<code>&lt;+34&gt;</code>处可知，第一个参数<code>0x8(%rsp)</code>满足<code>0xe &gt; 0x8(%rsp)</code>，第二个参数<code>0xc(%rsp)</code>必须为0。但是第一个参数需要根据<code>&lt;func4&gt;</code>函数来确定。</p>
<p><code>&lt;func4&gt;</code>的汇编代码如下：</p>
<p>第一次进入func4函数：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x0000000000400fce</span> &lt;+<span class="number">0</span>&gt;:	sub    $<span class="number">0x8</span>,%rsp</span><br><span class="line"><span class="number">0x0000000000400fd2</span> &lt;+<span class="number">4</span>&gt;:	mov    %edx,%eax # %eax=<span class="number">14</span></span><br><span class="line"><span class="number">0x0000000000400fd4</span> &lt;+<span class="number">6</span>&gt;:	sub    %esi,%eax # %eax=<span class="number">14</span><span class="number">-0</span>=<span class="number">14</span></span><br><span class="line"><span class="number">0x0000000000400fd6</span> &lt;+<span class="number">8</span>&gt;:	mov    %eax,%ecx # %ecx=<span class="number">14</span></span><br><span class="line"><span class="number">0x0000000000400fd8</span> &lt;+<span class="number">10</span>&gt;:	shr    $<span class="number">0x1f</span>,%ecx #逻辑右移<span class="number">31</span>位，%ecx=<span class="number">0</span></span><br><span class="line"><span class="number">0x0000000000400fdb</span> &lt;+<span class="number">13</span>&gt;:	add    %ecx,%eax # %eax=<span class="number">14</span></span><br><span class="line"><span class="number">0x0000000000400fdd</span> &lt;+<span class="number">15</span>&gt;:	sar    %eax #算术右移<span class="number">1</span>位，补sign，%eax=<span class="number">7</span></span><br><span class="line"><span class="number">0x0000000000400fdf</span> &lt;+<span class="number">17</span>&gt;:	<span class="built_in">lea</span>    (%rax,%rsi,<span class="number">1</span>),%ecx %ecx=<span class="number">7</span>+<span class="number">0</span>=<span class="number">7</span></span><br><span class="line"><span class="number">0x0000000000400fe2</span> &lt;+<span class="number">20</span>&gt;:	cmp    %edi,%ecx #第一个参数和%ecx=<span class="number">7</span>比较</span><br><span class="line"><span class="number">0x0000000000400fe4</span> &lt;+<span class="number">22</span>&gt;:	jle    <span class="number">0x400ff2</span> &lt;func4+<span class="number">36</span>&gt; #第一个参数 &lt;=<span class="number">7</span>跳至&lt;+<span class="number">36</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400fe6</span> &lt;+<span class="number">24</span>&gt;:	lea    <span class="number">-0x1</span>(%rcx),%edx #否则%edx=<span class="number">7</span><span class="number">-1</span>=<span class="number">6</span></span><br><span class="line"><span class="number">0x0000000000400fe9</span> &lt;+<span class="number">27</span>&gt;:	callq  <span class="number">0x400fce</span> &lt;func4&gt; #进入递归</span><br><span class="line"><span class="number">0x0000000000400fee</span> &lt;+<span class="number">32</span>&gt;:	add    %eax,%eax</span><br><span class="line"><span class="number">0x0000000000400ff0</span> &lt;+<span class="number">34</span>&gt;:	jmp    <span class="number">0x401007</span> &lt;func4+<span class="number">57</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400ff2</span> &lt;+<span class="number">36</span>&gt;:	mov    $<span class="number">0x0</span>,%eax</span><br><span class="line"><span class="number">0x0000000000400ff7</span> &lt;+<span class="number">41</span>&gt;:	cmp    %edi,%ecx #第一个参数和%ecx=<span class="number">7</span>比较</span><br><span class="line"><span class="number">0x0000000000400ff9</span> &lt;+<span class="number">43</span>&gt;:	jge    <span class="number">0x401007</span> &lt;func4+<span class="number">57</span>&gt; #若第一个参数 &gt;=<span class="number">7</span>跳出func4</span><br><span class="line"><span class="number">0x0000000000400ffb</span> &lt;+<span class="number">45</span>&gt;:	lea    <span class="number">0x1</span>(%rcx),%esi</span><br><span class="line"><span class="number">0x0000000000400ffe</span> &lt;+<span class="number">48</span>&gt;:	callq  <span class="number">0x400fce</span> &lt;func4&gt;</span><br><span class="line"><span class="number">0x0000000000401003</span> &lt;+<span class="number">53</span>&gt;:	lea    <span class="number">0x1</span>(%rax,%rax,<span class="number">1</span>),%eax</span><br><span class="line"><span class="number">0x0000000000401007</span> &lt;+<span class="number">57</span>&gt;:	add    $<span class="number">0x8</span>,%rsp</span><br><span class="line"><span class="number">0x000000000040100b</span> &lt;+<span class="number">61</span>&gt;:	retq   </span><br></pre></td></tr></table></figure>

<p><strong>分析：</strong>其实这个时候答案已经出来了，只要<strong>第一个参数为<code>7</code>和<code>%ecx=7</code>相同即可</strong>。但显然<code>func</code>是一个递归函数，我们进入递归看看，还有什么答案。</p>
<p>第一次递归：（记为<code>R1</code>）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x0000000000400fce</span> &lt;+<span class="number">0</span>&gt;:	sub    $<span class="number">0x8</span>,%rsp</span><br><span class="line"><span class="number">0x0000000000400fd2</span> &lt;+<span class="number">4</span>&gt;:	mov    %edx,%eax # %eax=<span class="number">6</span></span><br><span class="line"><span class="number">0x0000000000400fd4</span> &lt;+<span class="number">6</span>&gt;:	sub    %esi,%eax # %eax=<span class="number">6</span><span class="number">-0</span>=<span class="number">6</span></span><br><span class="line"><span class="number">0x0000000000400fd6</span> &lt;+<span class="number">8</span>&gt;:	mov    %eax,%ecx # %ecx=<span class="number">6</span></span><br><span class="line"><span class="number">0x0000000000400fd8</span> &lt;+<span class="number">10</span>&gt;:	shr    $<span class="number">0x1f</span>,%ecx #逻辑右移<span class="number">31</span>位，%ecx=<span class="number">0</span></span><br><span class="line"><span class="number">0x0000000000400fdb</span> &lt;+<span class="number">13</span>&gt;:	add    %ecx,%eax # %eax=<span class="number">6</span></span><br><span class="line"><span class="number">0x0000000000400fdd</span> &lt;+<span class="number">15</span>&gt;:	sar    %eax #算术右移<span class="number">1</span>位，%eax=<span class="number">3</span></span><br><span class="line"><span class="number">0x0000000000400fdf</span> &lt;+<span class="number">17</span>&gt;:	lea    (%rax,%rsi,<span class="number">1</span>),%ecx %ecx=<span class="number">3</span>+<span class="number">0</span>=<span class="number">3</span></span><br><span class="line"><span class="number">0x0000000000400fe2</span> &lt;+<span class="number">20</span>&gt;:	cmp    %edi,%ecx #第一个参数和%ecx=<span class="number">3</span>比较</span><br><span class="line"><span class="number">0x0000000000400fe4</span> &lt;+<span class="number">22</span>&gt;:	jle    <span class="number">0x400ff2</span> &lt;func4+<span class="number">36</span>&gt; #若第一个参数 &lt;=<span class="number">3</span>跳至&lt;+<span class="number">36</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400fe6</span> &lt;+<span class="number">24</span>&gt;:	lea    <span class="number">-0x1</span>(%rcx),%edx #否则，%edx=<span class="number">3</span><span class="number">-1</span>=<span class="number">2</span>，进入递归</span><br><span class="line"><span class="number">0x0000000000400fe9</span> &lt;+<span class="number">27</span>&gt;:	callq  <span class="number">0x400fce</span> &lt;func4&gt;</span><br><span class="line"><span class="number">0x0000000000400fee</span> &lt;+<span class="number">32</span>&gt;:	add    %eax,%eax</span><br><span class="line"><span class="number">0x0000000000400ff0</span> &lt;+<span class="number">34</span>&gt;:	jmp    <span class="number">0x401007</span> &lt;func4+<span class="number">57</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400ff2</span> &lt;+<span class="number">36</span>&gt;:	mov    $<span class="number">0x0</span>,%eax</span><br><span class="line"><span class="number">0x0000000000400ff7</span> &lt;+<span class="number">41</span>&gt;:	cmp    %edi,%ecx #第一个参数和%ecx=<span class="number">3</span>比较</span><br><span class="line"><span class="number">0x0000000000400ff9</span> &lt;+<span class="number">43</span>&gt;:	jge    <span class="number">0x401007</span> &lt;func4+<span class="number">57</span>&gt; #若第一个参数 &gt;=<span class="number">3</span>跳出递归</span><br><span class="line"><span class="number">0x0000000000400ffb</span> &lt;+<span class="number">45</span>&gt;:	lea    <span class="number">0x1</span>(%rcx),%esi</span><br><span class="line"><span class="number">0x0000000000400ffe</span> &lt;+<span class="number">48</span>&gt;:	callq  <span class="number">0x400fce</span> &lt;func4&gt;</span><br><span class="line"><span class="number">0x0000000000401003</span> &lt;+<span class="number">53</span>&gt;:	lea    <span class="number">0x1</span>(%rax,%rax,<span class="number">1</span>),%eax</span><br><span class="line"><span class="number">0x0000000000401007</span> &lt;+<span class="number">57</span>&gt;:	add    $<span class="number">0x8</span>,%rsp</span><br><span class="line"><span class="number">0x000000000040100b</span> &lt;+<span class="number">61</span>&gt;:	retq   </span><br></pre></td></tr></table></figure>

<p><strong>第一个参数为<code>3</code>和<code>%ecx=3</code>相同即可。</strong></p>
<p>第二次递归：（记为<code>R2</code>）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x0000000000400fce</span> &lt;+<span class="number">0</span>&gt;:	sub    $<span class="number">0x8</span>,%rsp</span><br><span class="line"><span class="number">0x0000000000400fd2</span> &lt;+<span class="number">4</span>&gt;:	mov    %edx,%eax # %eax=<span class="number">2</span></span><br><span class="line"><span class="number">0x0000000000400fd4</span> &lt;+<span class="number">6</span>&gt;:	sub    %esi,%eax # %eax=<span class="number">2</span><span class="number">-0</span>=<span class="number">2</span></span><br><span class="line"><span class="number">0x0000000000400fd6</span> &lt;+<span class="number">8</span>&gt;:	mov    %eax,%ecx # %ecx=<span class="number">2</span></span><br><span class="line"><span class="number">0x0000000000400fd8</span> &lt;+<span class="number">10</span>&gt;:	shr    $<span class="number">0x1f</span>,%ecx #逻辑右移<span class="number">31</span>位，%ecx=<span class="number">0</span></span><br><span class="line"><span class="number">0x0000000000400fdb</span> &lt;+<span class="number">13</span>&gt;:	add    %ecx,%eax # %eax=<span class="number">2</span></span><br><span class="line"><span class="number">0x0000000000400fdd</span> &lt;+<span class="number">15</span>&gt;:	sar    %eax #算术右移<span class="number">1</span>位，%eax=<span class="number">1</span></span><br><span class="line"><span class="number">0x0000000000400fdf</span> &lt;+<span class="number">17</span>&gt;:	lea    (%rax,%rsi,<span class="number">1</span>),%ecx %ecx=<span class="number">1</span>+<span class="number">0</span>=<span class="number">1</span></span><br><span class="line"><span class="number">0x0000000000400fe2</span> &lt;+<span class="number">20</span>&gt;:	cmp    %edi,%ecx #第一个参数和%ecx=<span class="number">1</span>比较</span><br><span class="line"><span class="number">0x0000000000400fe4</span> &lt;+<span class="number">22</span>&gt;:	jle    <span class="number">0x400ff2</span> &lt;func4+<span class="number">36</span>&gt; #若第一个参数 &lt;=<span class="number">1</span>跳至&lt;+<span class="number">36</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400fe6</span> &lt;+<span class="number">24</span>&gt;:	lea    <span class="number">-0x1</span>(%rcx),%edx #否则，%edx=<span class="number">1</span><span class="number">-1</span>=<span class="number">0</span>，进入递归</span><br><span class="line"><span class="number">0x0000000000400fe9</span> &lt;+<span class="number">27</span>&gt;:	callq  <span class="number">0x400fce</span> &lt;func4&gt;</span><br><span class="line"><span class="number">0x0000000000400fee</span> &lt;+<span class="number">32</span>&gt;:	add    %eax,%eax</span><br><span class="line"><span class="number">0x0000000000400ff0</span> &lt;+<span class="number">34</span>&gt;:	jmp    <span class="number">0x401007</span> &lt;func4+<span class="number">57</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400ff2</span> &lt;+<span class="number">36</span>&gt;:	mov    $<span class="number">0x0</span>,%eax</span><br><span class="line"><span class="number">0x0000000000400ff7</span> &lt;+<span class="number">41</span>&gt;:	cmp    %edi,%ecx #第一个参数和%ecx=<span class="number">1</span>比较</span><br><span class="line"><span class="number">0x0000000000400ff9</span> &lt;+<span class="number">43</span>&gt;:	jge    <span class="number">0x401007</span> &lt;func4+<span class="number">57</span>&gt; #若第一个参数 &gt;=<span class="number">1</span>跳出递归</span><br><span class="line"><span class="number">0x0000000000400ffb</span> &lt;+<span class="number">45</span>&gt;:	lea    <span class="number">0x1</span>(%rcx),%esi</span><br><span class="line"><span class="number">0x0000000000400ffe</span> &lt;+<span class="number">48</span>&gt;:	callq  <span class="number">0x400fce</span> &lt;func4&gt;</span><br><span class="line"><span class="number">0x0000000000401003</span> &lt;+<span class="number">53</span>&gt;:	lea    <span class="number">0x1</span>(%rax,%rax,<span class="number">1</span>),%eax</span><br><span class="line"><span class="number">0x0000000000401007</span> &lt;+<span class="number">57</span>&gt;:	add    $<span class="number">0x8</span>,%rsp</span><br><span class="line"><span class="number">0x000000000040100b</span> &lt;+<span class="number">61</span>&gt;:	retq   </span><br></pre></td></tr></table></figure>

<p><strong>第一个参数为<code>1</code>和<code>%ecx=1</code>相同即可。</strong></p>
<p>第三次递归：（记为<code>R3</code>）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x0000000000400fce</span> &lt;+<span class="number">0</span>&gt;:	sub    $<span class="number">0x8</span>,%rsp</span><br><span class="line"><span class="number">0x0000000000400fd2</span> &lt;+<span class="number">4</span>&gt;:	mov    %edx,%eax # %eax=<span class="number">0</span></span><br><span class="line"><span class="number">0x0000000000400fd4</span> &lt;+<span class="number">6</span>&gt;:	sub    %esi,%eax # %eax=<span class="number">0</span><span class="number">-0</span>=<span class="number">0</span></span><br><span class="line"><span class="number">0x0000000000400fd6</span> &lt;+<span class="number">8</span>&gt;:	mov    %eax,%ecx # %ecx=<span class="number">0</span></span><br><span class="line"><span class="number">0x0000000000400fd8</span> &lt;+<span class="number">10</span>&gt;:	shr    $<span class="number">0x1f</span>,%ecx #逻辑右移<span class="number">31</span>位，%ecx=<span class="number">0</span></span><br><span class="line"><span class="number">0x0000000000400fdb</span> &lt;+<span class="number">13</span>&gt;:	add    %ecx,%eax # %eax=<span class="number">0</span></span><br><span class="line"><span class="number">0x0000000000400fdd</span> &lt;+<span class="number">15</span>&gt;:	sar    %eax #算术右移<span class="number">1</span>位，%eax=<span class="number">0</span></span><br><span class="line"><span class="number">0x0000000000400fdf</span> &lt;+<span class="number">17</span>&gt;:	lea    (%rax,%rsi,<span class="number">1</span>),%ecx %ecx=<span class="number">0</span>+<span class="number">0</span>=<span class="number">0</span></span><br><span class="line"><span class="number">0x0000000000400fe2</span> &lt;+<span class="number">20</span>&gt;:	cmp    %edi,%ecx #第一个参数和%ecx=<span class="number">0</span>比较</span><br><span class="line"><span class="number">0x0000000000400fe4</span> &lt;+<span class="number">22</span>&gt;:	jle    <span class="number">0x400ff2</span> &lt;func4+<span class="number">36</span>&gt; #若第一个参数 &lt;=<span class="number">0</span>跳至&lt;+<span class="number">36</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400fe6</span> &lt;+<span class="number">24</span>&gt;:	lea    <span class="number">-0x1</span>(%rcx),%edx #否则，%edx=<span class="number">0</span><span class="number">-1</span>=<span class="number">-1</span>，进入递归</span><br><span class="line"><span class="number">0x0000000000400fe9</span> &lt;+<span class="number">27</span>&gt;:	callq  <span class="number">0x400fce</span> &lt;func4&gt;</span><br><span class="line"><span class="number">0x0000000000400fee</span> &lt;+<span class="number">32</span>&gt;:	add    %eax,%eax</span><br><span class="line"><span class="number">0x0000000000400ff0</span> &lt;+<span class="number">34</span>&gt;:	jmp    <span class="number">0x401007</span> &lt;func4+<span class="number">57</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400ff2</span> &lt;+<span class="number">36</span>&gt;:	mov    $<span class="number">0x0</span>,%eax</span><br><span class="line"><span class="number">0x0000000000400ff7</span> &lt;+<span class="number">41</span>&gt;:	cmp    %edi,%ecx #第一个参数和%ecx=<span class="number">0</span>比较</span><br><span class="line"><span class="number">0x0000000000400ff9</span> &lt;+<span class="number">43</span>&gt;:	jge    <span class="number">0x401007</span> &lt;func4+<span class="number">57</span>&gt; #若第一个参数 &gt;=<span class="number">0</span>跳出递归</span><br><span class="line"><span class="number">0x0000000000400ffb</span> &lt;+<span class="number">45</span>&gt;:	lea    <span class="number">0x1</span>(%rcx),%esi</span><br><span class="line"><span class="number">0x0000000000400ffe</span> &lt;+<span class="number">48</span>&gt;:	callq  <span class="number">0x400fce</span> &lt;func4&gt;</span><br><span class="line"><span class="number">0x0000000000401003</span> &lt;+<span class="number">53</span>&gt;:	lea    <span class="number">0x1</span>(%rax,%rax,<span class="number">1</span>),%eax</span><br><span class="line"><span class="number">0x0000000000401007</span> &lt;+<span class="number">57</span>&gt;:	add    $<span class="number">0x8</span>,%rsp</span><br><span class="line"><span class="number">0x000000000040100b</span> &lt;+<span class="number">61</span>&gt;:	retq   </span><br></pre></td></tr></table></figure>

<p><strong>第一个参数为<code>0</code>和<code>%ecx=0</code>相同即可。</strong></p>
<p>第四次递归：（记为<code>R4</code>）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x0000000000400fce</span> &lt;+<span class="number">0</span>&gt;:	sub    $<span class="number">0x8</span>,%rsp</span><br><span class="line"><span class="number">0x0000000000400fd2</span> &lt;+<span class="number">4</span>&gt;:	mov    %edx,%eax # %eax=<span class="number">-1</span></span><br><span class="line"><span class="number">0x0000000000400fd4</span> &lt;+<span class="number">6</span>&gt;:	sub    %esi,%eax # %eax=<span class="number">-1</span><span class="number">-0</span>=<span class="number">1</span></span><br><span class="line"><span class="number">0x0000000000400fd6</span> &lt;+<span class="number">8</span>&gt;:	mov    %eax,%ecx # %ecx=<span class="number">-1</span></span><br><span class="line"><span class="number">0x0000000000400fd8</span> &lt;+<span class="number">10</span>&gt;:	shr    $<span class="number">0x1f</span>,%ecx #逻辑右移<span class="number">31</span>位，%ecx=<span class="number">1</span></span><br><span class="line"><span class="number">0x0000000000400fdb</span> &lt;+<span class="number">13</span>&gt;:	add    %ecx,%eax # %eax=<span class="number">2</span></span><br><span class="line"><span class="number">0x0000000000400fdd</span> &lt;+<span class="number">15</span>&gt;:	sar    %eax #算术右移<span class="number">1</span>位，%eax=<span class="number">1</span></span><br><span class="line"><span class="number">0x0000000000400fdf</span> &lt;+<span class="number">17</span>&gt;:	lea    (%rax,%rsi,<span class="number">1</span>),%ecx %ecx=<span class="number">1</span>+<span class="number">0</span>=<span class="number">1</span></span><br><span class="line"><span class="number">0x0000000000400fe2</span> &lt;+<span class="number">20</span>&gt;:	cmp    %edi,%ecx #第一个参数和%ecx=<span class="number">1</span>比较</span><br><span class="line"><span class="number">0x0000000000400fe4</span> &lt;+<span class="number">22</span>&gt;:	jle    <span class="number">0x400ff2</span> &lt;func4+<span class="number">36</span>&gt; #若第一个参数 &lt;=<span class="number">1</span>跳至&lt;+<span class="number">36</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400fe6</span> &lt;+<span class="number">24</span>&gt;:	lea    <span class="number">-0x1</span>(%rcx),%edx #否则，%edx=<span class="number">1</span><span class="number">-1</span>=<span class="number">0</span>，进入递归</span><br><span class="line"><span class="number">0x0000000000400fe9</span> &lt;+<span class="number">27</span>&gt;:	callq  <span class="number">0x400fce</span> &lt;func4&gt;</span><br><span class="line"><span class="number">0x0000000000400fee</span> &lt;+<span class="number">32</span>&gt;:	add    %eax,%eax</span><br><span class="line"><span class="number">0x0000000000400ff0</span> &lt;+<span class="number">34</span>&gt;:	jmp    <span class="number">0x401007</span> &lt;func4+<span class="number">57</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400ff2</span> &lt;+<span class="number">36</span>&gt;:	mov    $<span class="number">0x0</span>,%eax</span><br><span class="line"><span class="number">0x0000000000400ff7</span> &lt;+<span class="number">41</span>&gt;:	cmp    %edi,%ecx</span><br><span class="line"><span class="number">0x0000000000400ff9</span> &lt;+<span class="number">43</span>&gt;:	jge    <span class="number">0x401007</span> &lt;func4+<span class="number">57</span>&gt; #大于等于</span><br><span class="line"><span class="number">0x0000000000400ffb</span> &lt;+<span class="number">45</span>&gt;:	lea    <span class="number">0x1</span>(%rcx),%esi</span><br><span class="line"><span class="number">0x0000000000400ffe</span> &lt;+<span class="number">48</span>&gt;:	callq  <span class="number">0x400fce</span> &lt;func4&gt;</span><br><span class="line"><span class="number">0x0000000000401003</span> &lt;+<span class="number">53</span>&gt;:	lea    <span class="number">0x1</span>(%rax,%rax,<span class="number">1</span>),%eax</span><br><span class="line"><span class="number">0x0000000000401007</span> &lt;+<span class="number">57</span>&gt;:	add    $<span class="number">0x8</span>,%rsp</span><br><span class="line"><span class="number">0x000000000040100b</span> &lt;+<span class="number">61</span>&gt;:	retq   </span><br></pre></td></tr></table></figure>

<p><strong>第一个参数为<code>1</code>和<code>%ecx=1</code>相同即可。</strong></p>
<p>第五次递归：（记为<code>R5</code>，此时<code>R5 = R3</code>）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x0000000000400fce</span> &lt;+<span class="number">0</span>&gt;:	sub    $<span class="number">0x8</span>,%rsp</span><br><span class="line"><span class="number">0x0000000000400fd2</span> &lt;+<span class="number">4</span>&gt;:	mov    %edx,%eax # %eax=<span class="number">0</span></span><br><span class="line"><span class="number">0x0000000000400fd4</span> &lt;+<span class="number">6</span>&gt;:	sub    %esi,%eax # %eax=<span class="number">0</span><span class="number">-0</span>=<span class="number">0</span></span><br><span class="line"><span class="number">0x0000000000400fd6</span> &lt;+<span class="number">8</span>&gt;:	mov    %eax,%ecx # %ecx=<span class="number">0</span></span><br><span class="line"><span class="number">0x0000000000400fd8</span> &lt;+<span class="number">10</span>&gt;:	shr    $<span class="number">0x1f</span>,%ecx #逻辑右移<span class="number">31</span>位，%ecx=<span class="number">0</span></span><br><span class="line"><span class="number">0x0000000000400fdb</span> &lt;+<span class="number">13</span>&gt;:	add    %ecx,%eax # %eax=<span class="number">0</span></span><br><span class="line"><span class="number">0x0000000000400fdd</span> &lt;+<span class="number">15</span>&gt;:	sar    %eax #算术右移<span class="number">1</span>位，%eax=<span class="number">0</span></span><br><span class="line"><span class="number">0x0000000000400fdf</span> &lt;+<span class="number">17</span>&gt;:	lea    (%rax,%rsi,<span class="number">1</span>),%ecx %ecx=<span class="number">0</span>+<span class="number">0</span>=<span class="number">0</span></span><br><span class="line"><span class="number">0x0000000000400fe2</span> &lt;+<span class="number">20</span>&gt;:	cmp    %edi,%ecx #第一个参数和%ecx=<span class="number">0</span>比较</span><br><span class="line"><span class="number">0x0000000000400fe4</span> &lt;+<span class="number">22</span>&gt;:	jle    <span class="number">0x400ff2</span> &lt;func4+<span class="number">36</span>&gt; #若第一个参数 &lt;=<span class="number">0</span>跳至&lt;+<span class="number">36</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400fe6</span> &lt;+<span class="number">24</span>&gt;:	lea    <span class="number">-0x1</span>(%rcx),%edx #否则，%edx=<span class="number">0</span><span class="number">-1</span>=<span class="number">-1</span>，进入递归</span><br><span class="line"><span class="number">0x0000000000400fe9</span> &lt;+<span class="number">27</span>&gt;:	callq  <span class="number">0x400fce</span> &lt;func4&gt;</span><br><span class="line"><span class="number">0x0000000000400fee</span> &lt;+<span class="number">32</span>&gt;:	add    %eax,%eax</span><br><span class="line"><span class="number">0x0000000000400ff0</span> &lt;+<span class="number">34</span>&gt;:	jmp    <span class="number">0x401007</span> &lt;func4+<span class="number">57</span>&gt;</span><br><span class="line"><span class="number">0x0000000000400ff2</span> &lt;+<span class="number">36</span>&gt;:	mov    $<span class="number">0x0</span>,%eax</span><br><span class="line"><span class="number">0x0000000000400ff7</span> &lt;+<span class="number">41</span>&gt;:	cmp    %edi,%ecx #第一个参数和%ecx=<span class="number">0</span>比较</span><br><span class="line"><span class="number">0x0000000000400ff9</span> &lt;+<span class="number">43</span>&gt;:	jge    <span class="number">0x401007</span> &lt;func4+<span class="number">57</span>&gt; #若第一个参数 &gt;=<span class="number">0</span>跳出递归</span><br><span class="line"><span class="number">0x0000000000400ffb</span> &lt;+<span class="number">45</span>&gt;:	lea    <span class="number">0x1</span>(%rcx),%esi</span><br><span class="line"><span class="number">0x0000000000400ffe</span> &lt;+<span class="number">48</span>&gt;:	callq  <span class="number">0x400fce</span> &lt;func4&gt;</span><br><span class="line"><span class="number">0x0000000000401003</span> &lt;+<span class="number">53</span>&gt;:	lea    <span class="number">0x1</span>(%rax,%rax,<span class="number">1</span>),%eax</span><br><span class="line"><span class="number">0x0000000000401007</span> &lt;+<span class="number">57</span>&gt;:	add    $<span class="number">0x8</span>,%rsp</span><br><span class="line"><span class="number">0x000000000040100b</span> &lt;+<span class="number">61</span>&gt;:	retq   </span><br></pre></td></tr></table></figure>

<p><strong>第一个参数为<code>0</code>和<code>%ecx=0</code>相同即可。</strong></p>
<p>由此可以知道，<code>R4</code>之后会一直在<code>R3、R4</code>之间无限循环，直到程序崩溃。那么，第一个参数的取值只能为：<code>0 1 3 7</code></p>
<p><strong>key：</strong></p>
<p>得出<code>4</code>组答案为：</p>
<table>
<thead>
<tr>
<th>0x8(%rsp) 第一个输入参数</th>
<th>7</th>
<th>3</th>
<th>1</th>
<th>0</th>
</tr>
</thead>
<tbody><tr>
<td>0xc(%rsp) 第二个输入参数</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody></table>
<p>我们取<code>0 0</code>这组输入。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入前</span></span><br><span class="line">Halfway there!</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入后</span></span><br><span class="line">Halfway there!</span><br><span class="line"><span class="number">0</span> <span class="number">0</span></span><br><span class="line">So you got that one.  Try <span class="keyword">this</span> one.</span><br></pre></td></tr></table></figure>

<h3 id="phase-5"><a href="#phase-5" class="headerlink" title="phase_5"></a>phase_5</h3><p><code>phase_5</code>的汇编代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x0000000000401062</span> &lt;+<span class="number">0</span>&gt;:	push   %rbx</span><br><span class="line"><span class="number">0x0000000000401063</span> &lt;+<span class="number">1</span>&gt;:	sub    $<span class="number">0x20</span>,%rsp</span><br><span class="line"><span class="number">0x0000000000401067</span> &lt;+<span class="number">5</span>&gt;:	mov    %rdi,%rbx #%rbx = 输入</span><br><span class="line"><span class="number">0x000000000040106a</span> &lt;+<span class="number">8</span>&gt;:	mov    %fs:<span class="number">0x28</span>,%rax #%rax = <span class="number">0x28</span> = <span class="number">40</span>D</span><br><span class="line"><span class="number">0x0000000000401073</span> &lt;+<span class="number">17</span>&gt;:	mov    %rax,<span class="number">0x18</span>(%rsp) #<span class="number">0x18</span>(%rsp) = <span class="number">0x28</span></span><br><span class="line"><span class="number">0x0000000000401078</span> &lt;+<span class="number">22</span>&gt;:	<span class="keyword">xor</span>    %eax,%eax #%eax = <span class="number">0x28</span> ^ <span class="number">0x28</span> = <span class="number">0</span></span><br><span class="line"><span class="number">0x000000000040107a</span> &lt;+<span class="number">24</span>&gt;:	callq  <span class="number">0x40131b</span> &lt;string_length&gt;</span><br><span class="line"><span class="number">0x000000000040107f</span> &lt;+<span class="number">29</span>&gt;:	cmp    $<span class="number">0x6</span>,%eax #字符串长度是否为<span class="number">6</span></span><br><span class="line"><span class="number">0x0000000000401082</span> &lt;+<span class="number">32</span>&gt;:	je     <span class="number">0x4010d2</span> &lt;phase_5+<span class="number">112</span>&gt; 是，跳转至+<span class="number">112</span></span><br><span class="line"><span class="number">0x0000000000401084</span> &lt;+<span class="number">34</span>&gt;:	callq  <span class="number">0x40143a</span> &lt;explode_bomb&gt;否，爆炸</span><br><span class="line"><span class="number">0x0000000000401089</span> &lt;+<span class="number">39</span>&gt;:	jmp    <span class="number">0x4010d2</span> &lt;phase_5+<span class="number">112</span>&gt;</span><br><span class="line"><span class="number">0x000000000040108b</span> &lt;+<span class="number">41</span>&gt;:	movzbl (%rbx,%rax,<span class="number">1</span>),%ecx #%ecx = %rbx + <span class="number">0</span>，第一次循环</span><br><span class="line"><span class="number">0x000000000040108f</span> &lt;+<span class="number">45</span>&gt;:	mov    %cl,(%rsp)</span><br><span class="line"><span class="number">0x0000000000401092</span> &lt;+<span class="number">48</span>&gt;:	mov    (%rsp),%rdx #%rdx = (%rsp) = %cl</span><br><span class="line"><span class="number">0x0000000000401096</span> &lt;+<span class="number">52</span>&gt;:	<span class="keyword">and</span>    $<span class="number">0xf</span>,%edx #%edx &amp;= $<span class="number">0xf</span>，%edx不变</span><br><span class="line"><span class="number">0x0000000000401099</span> &lt;+<span class="number">55</span>&gt;:	movzbl <span class="number">0x4024b0</span>(%rdx),%edx #%edx = <span class="number">0x4024b0</span>+%rdx</span><br><span class="line"><span class="number">0x00000000004010a0</span> &lt;+<span class="number">62</span>&gt;:	mov    %dl,<span class="number">0x10</span>(%rsp,%rax,<span class="number">1</span>) #%rsp+<span class="number">0x10</span>(<span class="number">16</span>D)+<span class="number">0</span> = %dl</span><br><span class="line"><span class="number">0x00000000004010a4</span> &lt;+<span class="number">66</span>&gt;:	add    $<span class="number">0x1</span>,%rax #%rax++</span><br><span class="line"><span class="number">0x00000000004010a8</span> &lt;+<span class="number">70</span>&gt;:	cmp    $<span class="number">0x6</span>,%rax #%rax = <span class="number">6</span>时，跳出循环</span><br><span class="line"><span class="number">0x00000000004010ac</span> &lt;+<span class="number">74</span>&gt;:	jne    <span class="number">0x40108b</span> &lt;phase_5+<span class="number">41</span>&gt; 否则，进入循环</span><br><span class="line"><span class="number">0x00000000004010ae</span> &lt;+<span class="number">76</span>&gt;:	movb   $<span class="number">0x0</span>,<span class="number">0x16</span>(%rsp) #<span class="number">0x16</span>(%rsp) = <span class="number">0</span></span><br><span class="line"><span class="number">0x00000000004010b3</span> &lt;+<span class="number">81</span>&gt;:	mov    $<span class="number">0x40245e</span>,%esi #%esi = <span class="number">0x40245e</span></span><br><span class="line"><span class="number">0x00000000004010b8</span> &lt;+<span class="number">86</span>&gt;:	lea    <span class="number">0x10</span>(%rsp),%rdi #入参</span><br><span class="line"><span class="number">0x00000000004010bd</span> &lt;+<span class="number">91</span>&gt;:	callq  <span class="number">0x401338</span> &lt;strings_not_equal&gt;#字符相等返回值为<span class="number">0</span>，否则为<span class="number">1</span></span><br><span class="line"><span class="number">0x00000000004010c2</span> &lt;+<span class="number">96</span>&gt;:	test   %eax,%eax</span><br><span class="line"><span class="number">0x00000000004010c4</span> &lt;+<span class="number">98</span>&gt;:	je     <span class="number">0x4010d9</span> &lt;phase_5+<span class="number">119</span>&gt; #返回值为<span class="number">0</span>，跳转至&lt;+<span class="number">119</span>&gt;</span><br><span class="line"><span class="number">0x00000000004010c6</span> &lt;+<span class="number">100</span>&gt;:	callq  <span class="number">0x40143a</span> &lt;explode_bomb&gt; #返回值为<span class="number">1</span>，爆炸</span><br><span class="line"><span class="number">0x00000000004010cb</span> &lt;+<span class="number">105</span>&gt;:	nopl   <span class="number">0x0</span>(%rax,%rax,<span class="number">1</span>)</span><br><span class="line"><span class="number">0x00000000004010d0</span> &lt;+<span class="number">110</span>&gt;:	jmp    <span class="number">0x4010d9</span> &lt;phase_5+<span class="number">119</span>&gt;</span><br><span class="line"><span class="number">0x00000000004010d2</span> &lt;+<span class="number">112</span>&gt;:	mov    $<span class="number">0x0</span>,%eax #%eax = <span class="number">0</span></span><br><span class="line"><span class="number">0x00000000004010d7</span> &lt;+<span class="number">117</span>&gt;:	jmp    <span class="number">0x40108b</span> &lt;phase_5+<span class="number">41</span>&gt;</span><br><span class="line"><span class="number">0x00000000004010d9</span> &lt;+<span class="number">119</span>&gt;:	mov    <span class="number">0x18</span>(%rsp),%rax</span><br><span class="line"><span class="number">0x00000000004010de</span> &lt;+<span class="number">124</span>&gt;:	<span class="keyword">xor</span>    %fs:<span class="number">0x28</span>,%rax</span><br><span class="line"><span class="number">0x00000000004010e7</span> &lt;+<span class="number">133</span>&gt;:	je     <span class="number">0x4010ee</span> &lt;phase_5+<span class="number">140</span>&gt; #<span class="number">0x18</span>(%rsp)=<span class="number">0x28</span>，结束pahse_5</span><br><span class="line"><span class="number">0x00000000004010e9</span> &lt;+<span class="number">135</span>&gt;:	callq  <span class="number">0x400b30</span> &lt;__stack_chk_fail@plt&gt; #否则进入fail函数</span><br><span class="line"><span class="number">0x00000000004010ee</span> &lt;+<span class="number">140</span>&gt;:	add    $<span class="number">0x20</span>,%rsp</span><br><span class="line"><span class="number">0x00000000004010f2</span> &lt;+<span class="number">144</span>&gt;:	pop    %rbx</span><br><span class="line"><span class="number">0x00000000004010f3</span> &lt;+<span class="number">145</span>&gt;:	retq   </span><br></pre></td></tr></table></figure>

<p><strong>分析：</strong><br>很显然，输入的字符串长度得为<code>6</code>。利用x/s指令，在<code>&lt;+55&gt;</code>处我们查看<code>x/s 0x4024b0</code>，给出一句嘲讽我们的话，<code>&quot;maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?&quot;</code>，<del>很明显不是答案</del>，也许是答案，也许不是答案，也许在暗示答案不能单单copy，我们无视他的嘲讽，对<code>&lt;+41&gt; ~ &lt;+74&gt;</code>处的循环进行专门分析。</p>
<p>第二次循环：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x000000000040108b</span> &lt;+<span class="number">41</span>&gt;:	movzbl (%rbx,%rax,<span class="number">1</span>),%ecx #%ecx = %rbx + <span class="number">1</span></span><br><span class="line"><span class="number">0x000000000040108f</span> &lt;+<span class="number">45</span>&gt;:	mov    %cl,(%rsp)</span><br><span class="line"><span class="number">0x0000000000401092</span> &lt;+<span class="number">48</span>&gt;:	mov    (%rsp),%rdx #%rdx = (%rsp) = %cl</span><br><span class="line"><span class="number">0x0000000000401096</span> &lt;+<span class="number">52</span>&gt;:	<span class="keyword">and</span>    $<span class="number">0xf</span>,%edx #%edx &amp;= <span class="number">0xf</span>,位级与运算，取尾<span class="number">4</span>位，范围为<span class="number">0</span> ~ <span class="number">15</span></span><br><span class="line"><span class="number">0x0000000000401099</span> &lt;+<span class="number">55</span>&gt;:	movzbl <span class="number">0x4024b0</span>(%rdx),%edx #%edx = <span class="number">0x4024b0</span>+%rdx</span><br><span class="line"><span class="number">0x00000000004010a0</span> &lt;+<span class="number">62</span>&gt;:	mov    %dl,<span class="number">0x10</span>(%rsp,%rax,<span class="number">1</span>) #%rsp+<span class="number">0x10</span>(<span class="number">16</span>D)+<span class="number">1</span> = %dl</span><br><span class="line"><span class="number">0x00000000004010a4</span> &lt;+<span class="number">66</span>&gt;:	add    $<span class="number">0x1</span>,%rax #%rax++</span><br><span class="line"><span class="number">0x00000000004010a8</span> &lt;+<span class="number">70</span>&gt;:	cmp    $<span class="number">0x6</span>,%rax #%rax = <span class="number">6</span>时，跳出循环</span><br><span class="line"><span class="number">0x00000000004010ac</span> &lt;+<span class="number">74</span>&gt;:	jne    <span class="number">0x40108b</span> &lt;phase_5+<span class="number">41</span>&gt; 否则，进入循环</span><br></pre></td></tr></table></figure>

<p>以此类推至第六次循环后，应当有<code>&lt;+41&gt;: %ecx = %rbx+5</code>和<code>&lt;+62&gt;: %rsp+0x10+5 = %dl</code>。此时，<code>%rbx</code>是<strong>输入</strong>，会有: <code>%rsp+0x10+5 = %dl = %edx = 0x4024b0+(%rdx &amp; 0xf)  </code><br>上式等价于：<code>= 0x4024b0+(%cl &amp; 0xf) = 0x4024b0+((%rbx+5) &amp; 0xf)</code><br>所有情况见下表。</p>
<table>
<thead>
<tr>
<th>%rsp+0x10+0</th>
<th>0x4024b0+%rbx+0（0x4024b0 + (第一个输入参数 &amp; 0xf)）</th>
</tr>
</thead>
<tbody><tr>
<td>%rsp+0x10+1</td>
<td>0x4024b0+%rbx+1（0x4024b0 + (第二个输入参数 &amp; 0xf)）</td>
</tr>
<tr>
<td>%rsp+0x10+2</td>
<td>0x4024b0+%rbx+2（0x4024b0 + (第三个输入参数 &amp; 0xf)）</td>
</tr>
<tr>
<td>%rsp+0x10+3</td>
<td>0x4024b0+%rbx+3（0x4024b0 + (第四个输入参数 &amp; 0xf)）</td>
</tr>
<tr>
<td>%rsp+0x10+4</td>
<td>0x4024b0+%rbx+4（0x4024b0 + (第五个输入参数 &amp; 0xf)）</td>
</tr>
<tr>
<td>%rsp+0x10+5</td>
<td>0x4024b0+%rbx+5（0x4024b0 + (第六个输入参数 &amp; 0xf)）</td>
</tr>
</tbody></table>
<p>可以看出<code>%rsp+0x10</code>的赋值是<code>0x4024b0</code>的偏移，偏移量范围为<code>0 ~ 15</code>，也就是<em>嘲讽句</em>的前16个字符，即<code>maduiersnfotvbyl</code>。</p>
<p>我们回到<code>phase_5</code>函数继续分析，利用x/s指令，在<code>&lt;+81&gt;</code>处我们查看<code>x/s 0x40245e</code>，给出一个单词字符串，<code>&quot;flyers&quot;</code>（译为<em>飞翔者们</em>或者<em>考熟的鸭子飞走了</em>）。也就是说，<code>&lt;+86&gt;</code>处的入参必须与<code>flyers</code>相同。</p>
<p>根据<code>maduiersnfotvbyl</code>，取得<code>flyers</code>对应<code>0x4024b0</code>的偏移量是<code>9、15、14、5、6、7</code>，但是<strong>只能输入<code>6</code>个字符</strong>，如果直接输入<code>91514567</code>，超过<code>6</code>个字符会爆炸。</p>
<p>要解决这个问题，可以先把偏移量转换为二进制<code>1001、1111、1110、0101、0110、0111</code>。因为有<code>%rbx &amp; 0xf</code>的位级操作，那么我们<strong>只要保证尾4位相同即可</strong>。这时可以联想到用来<strong>定义字符</strong>的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/ASCII/309296?fromtitle=ascii%E7%A0%81&fromid=99077&fr=aladdin">ASCII</a>表，那么答案有许多种，我比较懒，就只找尾4位为<code>1111</code>和<code>1110</code>的字符。分别为<code>/</code>和<code>.</code>，从而得到输入<code>9/.567</code>。</p>
<p><strong>key：</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入前</span></span><br><span class="line">So you got that one.  Try <span class="keyword">this</span> one.</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//输入后</span></span><br><span class="line">So you got that one.  Try <span class="keyword">this</span> one.</span><br><span class="line"><span class="number">9</span>/<span class="number">.567</span></span><br><span class="line">Good work!  On to the next...</span><br></pre></td></tr></table></figure>



<h3 id="phase-6"><a href="#phase-6" class="headerlink" title="phase_6"></a>phase_6</h3><p>查看<code>phase_6</code>的汇编代码：<br><strong>分析：</strong><br>好家伙，一个电脑屏幕根本装不下全部代码。我们分成几个部分来看。<strong>注意</strong>：<strong>在循环开始前会有一些变量准备</strong>。</p>
<p><strong>Part1</strong>，读入了6个整数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x00000000004010f4</span> &lt;+<span class="number">0</span>&gt;:	push   %r14</span><br><span class="line"><span class="number">0x00000000004010f6</span> &lt;+<span class="number">2</span>&gt;:	push   %r13</span><br><span class="line"><span class="number">0x00000000004010f8</span> &lt;+<span class="number">4</span>&gt;:	push   %r12</span><br><span class="line"><span class="number">0x00000000004010fa</span> &lt;+<span class="number">6</span>&gt;:	push   %rbp</span><br><span class="line"><span class="number">0x00000000004010fb</span> &lt;+<span class="number">7</span>&gt;:	push   %rbx</span><br><span class="line"><span class="number">0x00000000004010fc</span> &lt;+<span class="number">8</span>&gt;:	sub    $<span class="number">0x50</span>,%rsp</span><br><span class="line"><span class="number">0x0000000000401100</span> &lt;+<span class="number">12</span>&gt;:	mov    %rsp,%r13</span><br><span class="line"><span class="number">0x0000000000401103</span> &lt;+<span class="number">15</span>&gt;:	mov    %rsp,%rsi</span><br><span class="line"><span class="number">0x0000000000401106</span> &lt;+<span class="number">18</span>&gt;:	callq  <span class="number">0x40145c</span> &lt;read_six_numbers&gt; #读入<span class="number">6</span>个数字</span><br><span class="line"><span class="number">0x000000000040110b</span> &lt;+<span class="number">23</span>&gt;:	mov    %rsp,%r14</span><br><span class="line"><span class="number">0x000000000040110e</span> &lt;+<span class="number">26</span>&gt;:	mov    $<span class="number">0x0</span>,%r12d #%r12d = <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>根据<code>phase_2</code>的<code>&lt;read_six_numbers&gt;</code>分析可以知道，这段读入了6个整数，对栈帧<code>%rsp</code>偏移（偏移量为<code>4</code>）即是输入<code>input[i]，i取0 ~ 5</code>。如下表所示：</p>
<table>
<thead>
<tr>
<th>(%rsp)</th>
<th>0x4(%rsp)</th>
<th>0x8(%rsp)</th>
<th>0xc(%rsp)</th>
<th>0x10(%rsp)</th>
<th>0x14(%rsp)</th>
</tr>
</thead>
<tbody><tr>
<td>input[0]</td>
<td>input[1]</td>
<td>input[2]</td>
<td>input[3]</td>
<td>input[4]</td>
<td>input[5]</td>
</tr>
</tbody></table>
<p><strong>Part2</strong>，保证6个输入整数（<code>input[i]，i取0 ~ 5</code>）都不相同且范围为<strong>0 ~ 6</strong>。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#loop1，+<span class="number">32</span> ~ +<span class="number">93</span>该循环说明：<span class="number">1</span>&lt;= input[i] &lt;= <span class="number">6</span>，i取<span class="number">0</span> ~ <span class="number">5</span></span><br><span class="line"><span class="number">0x0000000000401114</span> &lt;+<span class="number">32</span>&gt;:	mov    %r13,%rbp #%rbp = %r13</span><br><span class="line"><span class="number">0x0000000000401117</span> &lt;+<span class="number">35</span>&gt;:	mov    <span class="number">0x0</span>(%r13),%eax #%eax = %r13 </span><br><span class="line"><span class="number">0x000000000040111b</span> &lt;+<span class="number">39</span>&gt;:	sub    $<span class="number">0x1</span>,%eax #%eax = %eax - <span class="number">1</span></span><br><span class="line"><span class="number">0x000000000040111e</span> &lt;+<span class="number">42</span>&gt;:	cmp    $<span class="number">0x5</span>,%eax #比较<span class="number">5</span>和%eax，</span><br><span class="line"><span class="number">0x0000000000401121</span> &lt;+<span class="number">45</span>&gt;:	jbe    <span class="number">0x401128</span> &lt;phase_6+<span class="number">52</span>&gt; #若%eax &lt;= <span class="number">5</span>，跳转至&lt;+<span class="number">52</span>&gt;</span><br><span class="line"><span class="number">0x0000000000401123</span> &lt;+<span class="number">47</span>&gt;:	callq  <span class="number">0x40143a</span> &lt;explode_bomb&gt; #否则，爆炸</span><br><span class="line"><span class="number">0x0000000000401128</span> &lt;+<span class="number">52</span>&gt;:	add    $<span class="number">0x1</span>,%r12d #%r12d++,flag值</span><br><span class="line"><span class="number">0x000000000040112c</span> &lt;+<span class="number">56</span>&gt;:	cmp    $<span class="number">0x6</span>,%r12d #比较<span class="number">6</span>和%r12d</span><br><span class="line"><span class="number">0x0000000000401130</span> &lt;+<span class="number">60</span>&gt;:	je     <span class="number">0x401153</span> &lt;phase_6+<span class="number">95</span>&gt; #若<span class="number">6</span> == %r12d，结束loop2</span><br><span class="line"><span class="number">0x0000000000401132</span> &lt;+<span class="number">62</span>&gt;:	mov    %r12d,%ebx #否则，%ebx = %r12d</span><br><span class="line">#loop2，+<span class="number">65</span> ~ +<span class="number">87</span>,该循环是loop1的子循环，用来是保证<span class="number">6</span>个输入都不相等</span><br><span class="line"><span class="number">0x0000000000401135</span> &lt;+<span class="number">65</span>&gt;:	movslq %ebx,%rax </span><br><span class="line"><span class="number">0x0000000000401138</span> &lt;+<span class="number">68</span>&gt;:	mov    (%rsp,%rax,<span class="number">4</span>),%eax #%eax = %rsp+<span class="number">4</span>*%rax</span><br><span class="line"><span class="number">0x000000000040113b</span> &lt;+<span class="number">71</span>&gt;:	cmp    %eax,<span class="number">0x0</span>(%rbp) #比较%rsp+<span class="number">4</span>*%rax和%rsp</span><br><span class="line"><span class="number">0x000000000040113e</span> &lt;+<span class="number">74</span>&gt;:	jne    <span class="number">0x401145</span> &lt;phase_6+<span class="number">81</span>&gt; #若不相等，跳转至&lt;+<span class="number">81</span>&gt;</span><br><span class="line"><span class="number">0x0000000000401140</span> &lt;+<span class="number">76</span>&gt;:	callq  <span class="number">0x40143a</span> &lt;explode_bomb&gt; #否则，爆炸</span><br><span class="line"><span class="number">0x0000000000401145</span> &lt;+<span class="number">81</span>&gt;:	add    $<span class="number">0x1</span>,%ebx #%ebx++,loop2取input[i]</span><br><span class="line"><span class="number">0x0000000000401148</span> &lt;+<span class="number">84</span>&gt;:	cmp    $<span class="number">0x5</span>,%ebx #比较<span class="number">5</span>和%ebx</span><br><span class="line"><span class="number">0x000000000040114b</span> &lt;+<span class="number">87</span>&gt;:	jle    <span class="number">0x401135</span> &lt;phase_6+<span class="number">65</span>&gt; #若%ebx &lt;= <span class="number">5</span>，进入loop2</span><br><span class="line"><span class="number">0x000000000040114d</span> &lt;+<span class="number">89</span>&gt;:	add    $<span class="number">0x4</span>,%r13 #%r13+<span class="number">4</span>，loop1取input[i]</span><br><span class="line"><span class="number">0x0000000000401151</span> &lt;+<span class="number">93</span>&gt;:	jmp    <span class="number">0x401114</span> &lt;phase_6+<span class="number">32</span>&gt; #进入loop1</span><br></pre></td></tr></table></figure>

<p>loop1确定了<code>input[i]</code>的取值范围为：<code>1 ~ 6</code>。loop2保证6个输入都不相等。<br><strong>取值范围如何确定的？</strong>由<code>+39 ~ +45</code>处得出，<code>input[i] &lt;= 6</code>。同时，因为<code>+45</code>的 <code>jbe</code> 是对<strong>无符号数</strong>操作，若<code>input[i]</code>取 <code>0</code> ，执行<code>0 - 1 = -1</code>在比较时会<strong>出错（溢出）</strong>，所以不能取<code>0</code>。故只能取<code>1 ~ 6</code>。</p>
<p><strong>Part3</strong>，执行算式：<code>input[i] = 7 - input[i]</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x0000000000401153</span> &lt;+<span class="number">95</span>&gt;:	lea    <span class="number">0x18</span>(%rsp),%rsi #%rsi = <span class="number">0x18</span>(%rsp)</span><br><span class="line"><span class="number">0x0000000000401158</span> &lt;+<span class="number">100</span>&gt;:	mov    %r14,%rax #%rax = %r14 = %rsp</span><br><span class="line"><span class="number">0x000000000040115b</span> &lt;+<span class="number">103</span>&gt;:	mov    $<span class="number">0x7</span>,%ecx #%ecx = <span class="number">7</span></span><br><span class="line">#loop3，+<span class="number">108</span> ~ +<span class="number">121</span>，该循环执行算式：input[i] = <span class="number">7</span> - input[i]</span><br><span class="line"><span class="number">0x0000000000401160</span> &lt;+<span class="number">108</span>&gt;:	mov    %ecx,%edx</span><br><span class="line"><span class="number">0x0000000000401162</span> &lt;+<span class="number">110</span>&gt;:	sub    (%rax),%edx #%edx = <span class="number">7</span> - (%rax)</span><br><span class="line"><span class="number">0x0000000000401164</span> &lt;+<span class="number">112</span>&gt;:	mov    %edx,(%rax) #(%rax) = %edx</span><br><span class="line"><span class="number">0x0000000000401166</span> &lt;+<span class="number">114</span>&gt;:	add    $<span class="number">0x4</span>,%rax #%rax+<span class="number">4</span>，取input[i]</span><br><span class="line"><span class="number">0x000000000040116a</span> &lt;+<span class="number">118</span>&gt;:	cmp    %rsi,%rax #比较%rsi=<span class="number">0x18</span>(%rsp)和%rax+<span class="number">4</span></span><br><span class="line"><span class="number">0x000000000040116d</span> &lt;+<span class="number">121</span>&gt;:	jne    <span class="number">0x401160</span> &lt;phase_6+<span class="number">108</span>&gt;</span><br></pre></td></tr></table></figure>

<p><strong>Part4</strong>，引入<strong>链表</strong>并<strong>改变链表顺序</strong>。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> ##注意，执行loop3后，后面的input[i] = <span class="number">7</span> - input[i]</span><br><span class="line">##在此重新命名为：sub_input[i]</span><br><span class="line"> <span class="number">0x000000000040116f</span> &lt;+<span class="number">123</span>&gt;:	mov    $<span class="number">0x0</span>,%esi #%esi = <span class="number">0</span></span><br><span class="line"> #loop4，+<span class="number">128</span>~+<span class="number">181</span>，该循环执行赋值算式：%rsp + <span class="number">8</span>*i + <span class="number">0x20</span> = $<span class="number">0x6032d0</span> + (<span class="number">8</span>*(input[i]<span class="number">-1</span>))</span><br><span class="line"> <span class="number">0x0000000000401174</span> &lt;+<span class="number">128</span>&gt;:	jmp    <span class="number">0x401197</span> &lt;phase_6+<span class="number">163</span>&gt;</span><br><span class="line"> #loop5，+<span class="number">130</span>~+<span class="number">139</span>，该循环是loo4的子循环，执行<span class="number">0x6032d</span>自加<span class="number">8</span>,自加次数为input[i]<span class="number">-1</span></span><br><span class="line"> <span class="number">0x0000000000401176</span> &lt;+<span class="number">130</span>&gt;:	mov    <span class="number">0x8</span>(%rdx),%rdx #%rdx += <span class="number">8</span></span><br><span class="line"> <span class="number">0x000000000040117a</span> &lt;+<span class="number">134</span>&gt;:	add    $<span class="number">0x1</span>,%eax #%eax++,flag值</span><br><span class="line"> <span class="number">0x000000000040117d</span> &lt;+<span class="number">137</span>&gt;:	cmp    %ecx,%eax #比较input[i]和%eax</span><br><span class="line"> <span class="number">0x000000000040117f</span> &lt;+<span class="number">139</span>&gt;:	jne    <span class="number">0x401176</span> &lt;phase_6+<span class="number">130</span>&gt; #不相等,则继续loop5</span><br><span class="line"> <span class="number">0x0000000000401181</span> &lt;+<span class="number">141</span>&gt;:	jmp    <span class="number">0x401188</span> &lt;phase_6+<span class="number">148</span>&gt; #相等，-&gt;+<span class="number">148</span>,进入loop4</span><br><span class="line"> <span class="number">0x0000000000401183</span> &lt;+<span class="number">143</span>&gt;:	mov    $<span class="number">0x6032d0</span>,%edx #%edx = <span class="number">0x6032d0</span></span><br><span class="line"> <span class="number">0x0000000000401188</span> &lt;+<span class="number">148</span>&gt;:	mov    %rdx,<span class="number">0x20</span>(%rsp,%rsi,<span class="number">2</span>) #<span class="number">0x20</span>+%rsp+<span class="number">2</span>*%rsi = %rdx</span><br><span class="line"> <span class="number">0x000000000040118d</span> &lt;+<span class="number">153</span>&gt;:	add    $<span class="number">0x4</span>,%rsi #%rsi+<span class="number">4</span>，flag值</span><br><span class="line"> <span class="number">0x0000000000401191</span> &lt;+<span class="number">157</span>&gt;:	cmp    $<span class="number">0x18</span>,%rsi #比较<span class="number">0x18</span>和flag值</span><br><span class="line"> <span class="number">0x0000000000401195</span> &lt;+<span class="number">161</span>&gt;:	je     <span class="number">0x4011ab</span> &lt;phase_6+<span class="number">183</span>&gt; #若相等，结束loop4</span><br><span class="line"> <span class="number">0x0000000000401197</span> &lt;+<span class="number">163</span>&gt;:	mov    (%rsp,%rsi,<span class="number">1</span>),%ecx #取input[i]</span><br><span class="line"> <span class="number">0x000000000040119a</span> &lt;+<span class="number">166</span>&gt;:	cmp    $<span class="number">0x1</span>,%ecx #比较<span class="number">1</span>和input[i]</span><br><span class="line"> <span class="number">0x000000000040119d</span> &lt;+<span class="number">169</span>&gt;:	jle    <span class="number">0x401183</span> &lt;phase_6+<span class="number">143</span>&gt; #若input[i] &lt;= <span class="number">1</span>，跳转至+<span class="number">143</span></span><br><span class="line"> <span class="number">0x000000000040119f</span> &lt;+<span class="number">171</span>&gt;:	mov    $<span class="number">0x1</span>,%eax #否则，%eax = <span class="number">1</span></span><br><span class="line"> <span class="number">0x00000000004011a4</span> &lt;+<span class="number">176</span>&gt;:	mov    $<span class="number">0x6032d0</span>,%edx #&amp;edx = <span class="number">0x6032d0</span></span><br><span class="line"> <span class="number">0x00000000004011a9</span> &lt;+<span class="number">181</span>&gt;:	jmp    <span class="number">0x401176</span> &lt;phase_6+<span class="number">130</span>&gt; #进入loop5</span><br></pre></td></tr></table></figure>

<p>首先我们查看<code>0x6032d0</code>，一开始用<code>x/s</code>指令都是乱码，如图所示。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s <span class="number">0x6032d0</span></span><br><span class="line"><span class="number">0x6032d0</span> &lt;node1&gt;:	<span class="string">&quot;L\001&quot;</span></span><br><span class="line">(gdb) x/<span class="number">100</span>s <span class="number">0x6032d0</span></span><br><span class="line"><span class="number">0x6032d0</span> &lt;node1&gt;:	<span class="string">&quot;L\001&quot;</span></span><br><span class="line"><span class="number">0x6032d3</span> &lt;node1+<span class="number">3</span>&gt;:	<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">0x6032d4</span> &lt;node1+<span class="number">4</span>&gt;:	<span class="string">&quot;\001&quot;</span></span><br><span class="line"><span class="number">0x6032d6</span> &lt;node1+<span class="number">6</span>&gt;:	<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">0x6032d7</span> &lt;node1+<span class="number">7</span>&gt;:	<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">0x6032d8</span> &lt;node1+<span class="number">8</span>&gt;:	<span class="string">&quot;\340\062`&quot;</span></span><br><span class="line"><span class="number">0x6032dc</span> &lt;node1+<span class="number">12</span>&gt;:	<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">0x6032dd</span> &lt;node1+<span class="number">13</span>&gt;:	<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">0x6032de</span> &lt;node1+<span class="number">14</span>&gt;:	<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">0x6032df</span> &lt;node1+<span class="number">15</span>&gt;:	<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="number">0x6032e0</span> &lt;node2&gt;:	<span class="string">&quot;\250&quot;</span></span><br><span class="line"><span class="number">0x6032e2</span> &lt;node2+<span class="number">2</span>&gt;:	<span class="string">&quot;&quot;</span></span><br><span class="line">...</span><br><span class="line">--Type &lt;RET&gt; <span class="keyword">for</span> more, q to quit, c to <span class="keyword">continue</span> without paging--</span><br></pre></td></tr></table></figure>

<p>但是注意到<code>node1</code>，说明其很有可能是<strong>链表</strong>。<br>我们用<code>x/24xw</code>指令，按xw格式（十六进制4字节格式）输出24个数据。<br>如图所示，符合我们的猜测，就是链表，<code>0x6032d0</code>是head指针。<br>其中，<strong>node</strong>是节点地址，<strong>val</strong>是节点值，<strong>order</strong>是它的序列（一共6个），<strong>next</strong>是下个节点的地址（能够发现它刚好就是按照序列排列的，最后一个节点的next是<code>0x0即NULL</code>）。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/<span class="number">24</span>xw <span class="number">0x6032d0</span></span><br><span class="line"><span class="number">0x6032d0</span> &lt;node1&gt;:	<span class="number">0x0000014c</span>	<span class="number">0x00000001</span>	<span class="number">0x006032e0</span>	<span class="number">0x00000000</span></span><br><span class="line"><span class="number">0x6032e0</span> &lt;node2&gt;:	<span class="number">0x000000a8</span>	<span class="number">0x00000002</span>	<span class="number">0x006032f0</span>	<span class="number">0x00000000</span></span><br><span class="line"><span class="number">0x6032f0</span> &lt;node3&gt;:	<span class="number">0x0000039c</span>	<span class="number">0x00000003</span>	<span class="number">0x00603300</span>	<span class="number">0x00000000</span></span><br><span class="line"><span class="number">0x603300</span> &lt;node4&gt;:	<span class="number">0x000002b3</span>	<span class="number">0x00000004</span>	<span class="number">0x00603310</span>	<span class="number">0x00000000</span></span><br><span class="line"><span class="number">0x603310</span> &lt;node5&gt;:	<span class="number">0x000001dd</span>	<span class="number">0x00000005</span>	<span class="number">0x00603320</span>	<span class="number">0x00000000</span></span><br><span class="line"><span class="number">0x603320</span> &lt;node6&gt;:	<span class="number">0x000001bb</span>	<span class="number">0x00000006</span>	<span class="number">0x00000000</span>	<span class="number">0x00000000</span></span><br><span class="line"></span><br><span class="line">##注释一下</span><br><span class="line">node 							val         order       *next </span><br><span class="line"><span class="number">0x6032d0</span> &lt;node1&gt;:	<span class="number">0x0000014c</span>	<span class="number">0x00000001</span>	<span class="number">0x006032e0</span>	<span class="number">0x00000000</span></span><br><span class="line"><span class="number">0x6032e0</span> &lt;node2&gt;:	<span class="number">0x000000a8</span>	<span class="number">0x00000002</span>	<span class="number">0x006032f0</span>	<span class="number">0x00000000</span></span><br><span class="line"><span class="number">0x6032f0</span> &lt;node3&gt;:	<span class="number">0x0000039c</span>	<span class="number">0x00000003</span>	<span class="number">0x00603300</span>	<span class="number">0x00000000</span></span><br><span class="line"><span class="number">0x603300</span> &lt;node4&gt;:	<span class="number">0x000002b3</span>	<span class="number">0x00000004</span>	<span class="number">0x00603310</span>	<span class="number">0x00000000</span></span><br><span class="line"><span class="number">0x603310</span> &lt;node5&gt;:	<span class="number">0x000001dd</span>	<span class="number">0x00000005</span>	<span class="number">0x00603320</span>	<span class="number">0x00000000</span></span><br><span class="line"><span class="number">0x603320</span> &lt;node6&gt;:	<span class="number">0x000001bb</span>	<span class="number">0x00000006</span>	<span class="number">0x00000000</span>	<span class="number">0x00000000</span></span><br><span class="line">##注意到，node的间隔为<span class="number">0x10</span> = <span class="number">16</span>D</span><br></pre></td></tr></table></figure>

<p>那么，该段循环是<strong>怎么改变链表顺序的呢？</strong>首先引入栈帧<code>%rsp + 8*i + 0x20，i取0 ~ 5</code>，然后在<code>+130 ~ +137 </code>，<code>0x6032d0</code>将随<code>sub_input[i]</code>的改变而改变，最后将改变后的链表逐个赋给栈帧。<br>即执行执行赋值算式：<code>%rsp + 8*i + 0x20 = $0x6032d0 + (8*(sub_input[i]-1))</code><br>这样下来就能够重排链表了。<em>但此处还没有给出改变链表顺序的标准是什么。</em><br>但注意一个重要的细节问题：<strong>改变时0x6032d0的间隔为8D，但我们需要的间隔为0x10 = 16D，如何解决？</strong><br>事实上，间隔为8也没关系。<strong>只要部分+8的地址<em>所存数值</em>恰好为+16的地址即可</strong>。（不是所有地址都需要这样，另一部分地址执行两次+8就行了）<br>上述表述等价于三个等式<br> <code>*(0x6032d0+8) = 0x6032e0</code>、<code>*(0x6032f0+8) = 0x603200</code>、<code>*（0x603310+8）= 0x603320 </code>成立。<br>我们用p/x 指令打印数值看三个等式是否成立。（这个成立是<code>phase_6</code>已经设置好的，但不查看之前完全不知道）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p/x *(<span class="number">0x6032d0</span>+<span class="number">8</span>)</span><br><span class="line">$<span class="number">1</span> = <span class="number">0x6032e0</span></span><br><span class="line">(gdb) p/x *(<span class="number">0x6032f0</span>+<span class="number">8</span>)</span><br><span class="line">$<span class="number">2</span> = <span class="number">0x603300</span></span><br><span class="line">(gdb) p/x *(<span class="number">0x603310</span>+<span class="number">8</span>)</span><br><span class="line">$<span class="number">3</span> = <span class="number">0x603320</span></span><br><span class="line">#证明等式成立。</span><br></pre></td></tr></table></figure>

<p>执行part4后，可以得出如下表格：</p>
<table>
<thead>
<tr>
<th>recom_node1</th>
<th>recom_node2</th>
<th>recom_node3</th>
<th>recom_node4</th>
<th>recom_node5</th>
<th>recom_node6</th>
</tr>
</thead>
<tbody><tr>
<td>%rsp + 0x20</td>
<td>%rsp + 0x28</td>
<td>%rsp + 0x30</td>
<td>%rsp + 0x38</td>
<td>%rsp + 0x40</td>
<td>%rsp + 0x48</td>
</tr>
</tbody></table>
<p>说明<code>recom_node1 ~ recom_node6</code>将逐个放入栈帧<code>%rsp + 0x20 ~ %rsp + 0x48</code>。<br>注意：<strong>命名为recom_node是因为节点已经随sub_input而重新排列了</strong>，也就是所谓的<strong>改变链表顺序</strong>。</p>
<p><strong>part5</strong>，重新连接next。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x00000000004011ab</span> &lt;+<span class="number">183</span>&gt;:	mov    <span class="number">0x20</span>(%rsp),%rbx </span><br><span class="line"><span class="number">0x00000000004011b0</span> &lt;+<span class="number">188</span>&gt;:	lea    <span class="number">0x28</span>(%rsp),%rax </span><br><span class="line"><span class="number">0x00000000004011b5</span> &lt;+<span class="number">193</span>&gt;:	lea    <span class="number">0x50</span>(%rsp),%rsi #%rsi = <span class="number">0x50</span>(%rsp) = <span class="number">0</span></span><br><span class="line"><span class="number">0x00000000004011ba</span> &lt;+<span class="number">198</span>&gt;:	mov    %rbx,%rcx</span><br><span class="line">#loop6，+<span class="number">201</span>~+<span class="number">220</span>，判断flag值的<span class="number">5</span>次+初始<span class="number">1</span>次，</span><br><span class="line">#执行<span class="number">6</span>次赋值算式：<span class="number">0x8</span>+(<span class="number">0x20</span>(%rsp)+(j<span class="number">-1</span>)*<span class="number">8</span>) = (<span class="number">0x28</span>(%rsp)+j*<span class="number">8</span>)，j取<span class="number">0</span> ~ <span class="number">5</span></span><br><span class="line">#会将间隔为<span class="number">8</span>的%<span class="number">0x28</span>(%rsp) ~ <span class="number">0x50</span>(%rsp)的地址，逐个赋给间隔为<span class="number">8</span>的%<span class="number">0x20</span>(%rsp) ~ <span class="number">0x48</span>(%rsp)</span><br><span class="line">#loop6结束时，%rdx = <span class="number">0x48</span>(%rsp)</span><br><span class="line"><span class="number">0x00000000004011bd</span> &lt;+<span class="number">201</span>&gt;:	mov    (%rax),%rdx</span><br><span class="line"><span class="number">0x00000000004011c0</span> &lt;+<span class="number">204</span>&gt;:	mov    %rdx,<span class="number">0x8</span>(%rcx) #<span class="number">0x8</span>(%rcx+(j<span class="number">-1</span>)*<span class="number">8</span>) = %rax+j*<span class="number">8</span></span><br><span class="line"><span class="number">0x00000000004011c4</span> &lt;+<span class="number">208</span>&gt;:	add    $<span class="number">0x8</span>,%rax #%rax += <span class="number">8</span>，记为j，每次增<span class="number">8</span>，也是flag值</span><br><span class="line"><span class="number">0x00000000004011c8</span> &lt;+<span class="number">212</span>&gt;:	cmp    %rsi,%rax #比较%rsi和%rax，执行<span class="number">5</span>次</span><br><span class="line"><span class="number">0x00000000004011cb</span> &lt;+<span class="number">215</span>&gt;:	je     <span class="number">0x4011d2</span> &lt;phase_6+<span class="number">222</span>&gt; #若相等，结束loop6</span><br><span class="line"><span class="number">0x00000000004011cd</span> &lt;+<span class="number">217</span>&gt;:	mov    %rdx,%rcx #否则，%rcx = %rdx</span><br><span class="line"><span class="number">0x00000000004011d0</span> &lt;+<span class="number">220</span>&gt;:	jmp    <span class="number">0x4011bd</span> &lt;phase_6+<span class="number">201</span>&gt; #-&gt; +<span class="number">201</span>，继续loop6</span><br></pre></td></tr></table></figure>

<p><strong>part6</strong>，说明改变链表顺序的标准：<strong>按val降序排列</strong>。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x00000000004011d2</span> &lt;+<span class="number">222</span>&gt;:	movq   $<span class="number">0x0</span>,<span class="number">0x8</span>(%rdx) #<span class="number">0x8</span>(%rdx) = <span class="number">0x50</span>(%rsp) = <span class="number">0</span></span><br><span class="line"><span class="number">0x00000000004011da</span> &lt;+<span class="number">230</span>&gt;:	mov    $<span class="number">0x5</span>,%ebp #%ebp = <span class="number">5</span></span><br><span class="line">#loop7，判断flag值的<span class="number">5</span>次+初始<span class="number">1</span>次，</span><br><span class="line">#共执行<span class="number">6</span>次判断算式：(<span class="number">0x8</span>+<span class="number">0x20</span>+%rsp+k*<span class="number">8</span>) &gt;= (<span class="number">0x20</span>+%rsp+k*<span class="number">8</span>) ? 继续执行直到k=<span class="number">5</span>结束:爆炸</span><br><span class="line"><span class="number">0x00000000004011df</span> &lt;+<span class="number">235</span>&gt;:	mov    <span class="number">0x8</span>(%rbx),%rax </span><br><span class="line"><span class="number">0x00000000004011e3</span> &lt;+<span class="number">239</span>&gt;:	mov    (%rax),%eax </span><br><span class="line"><span class="number">0x00000000004011e5</span> &lt;+<span class="number">241</span>&gt;:	cmp    %eax,(%rbx) #比较(<span class="number">0x8</span>+<span class="number">0x20</span>+%rsp+k*<span class="number">8</span>)和(<span class="number">0x20</span>+%rsp+k*<span class="number">8</span>)</span><br><span class="line"><span class="number">0x00000000004011e7</span> &lt;+<span class="number">243</span>&gt;:	jge    <span class="number">0x4011ee</span> &lt;phase_6+<span class="number">250</span>&gt;  #若前者 &gt;= 后者,-&gt; +<span class="number">250</span></span><br><span class="line"><span class="number">0x00000000004011e9</span> &lt;+<span class="number">245</span>&gt;:	callq  <span class="number">0x40143a</span> &lt;explode_bomb&gt; #否则，爆炸</span><br><span class="line"><span class="number">0x00000000004011ee</span> &lt;+<span class="number">250</span>&gt;:	mov    <span class="number">0x8</span>(%rbx),%rbx #取<span class="number">0x20</span>+%rsp+k*<span class="number">8</span></span><br><span class="line"><span class="number">0x00000000004011f2</span> &lt;+<span class="number">254</span>&gt;:	sub    $<span class="number">0x1</span>,%ebp #%ebp--,flag值，执行<span class="number">5</span>次</span><br><span class="line"><span class="number">0x00000000004011f5</span> &lt;+<span class="number">257</span>&gt;:	jne    <span class="number">0x4011df</span> &lt;phase_6+<span class="number">235</span>&gt; #%ebp不为<span class="number">0</span>时，继续loop7</span><br><span class="line">##</span><br><span class="line"><span class="number">0x00000000004011f7</span> &lt;+<span class="number">259</span>&gt;:	add    $<span class="number">0x50</span>,%rsp #出栈</span><br><span class="line"><span class="number">0x00000000004011fb</span> &lt;+<span class="number">263</span>&gt;:	pop    %rbx</span><br><span class="line"><span class="number">0x00000000004011fc</span> &lt;+<span class="number">264</span>&gt;:	pop    %rbp</span><br><span class="line"><span class="number">0x00000000004011fd</span> &lt;+<span class="number">265</span>&gt;:	pop    %r12</span><br><span class="line"><span class="number">0x00000000004011ff</span> &lt;+<span class="number">267</span>&gt;:	pop    %r13</span><br><span class="line"><span class="number">0x0000000000401201</span> &lt;+<span class="number">269</span>&gt;:	pop    %r14</span><br><span class="line"><span class="number">0x0000000000401203</span> &lt;+<span class="number">271</span>&gt;:	retq    </span><br></pre></td></tr></table></figure>

<p><strong>分析：</strong></p>
<p>注意，<code>0x10 = 16D，0x14 = 20D</code>。<br><code>flag</code>这个<em>变量命名</em>常用来<strong>当作循环是否结束的标志</strong>。</p>
<h3 id="continue…"><a href="#continue…" class="headerlink" title="continue…"></a>continue…</h3><p>不能用<code>x/s 0x6032d0</code>check.<code>x/24xw 0x6032d0</code> <del>先打断点，当运行到那个程序时，就打断了。可以随机输入，然后查看</del></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>






    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/c/" rel="tag"># c</a>
              <a href="/tags/csapp-lab/" rel="tag"># csapp_lab</a>
              <a href="/tags/assembly/" rel="tag"># assembly</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/09/19/PTA-BasicSet/" rel="prev" title="PTA-基础编程题目集">
      <i class="fa fa-chevron-left"></i> PTA-基础编程题目集
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/09/29/Tips/" rel="next" title="Tips">
      Tips <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Bomb-Lab"><span class="nav-number">1.</span> <span class="nav-text">Bomb Lab</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E5%89%8D%E5%87%86%E5%A4%87"><span class="nav-number">1.1.</span> <span class="nav-text">实验前准备</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%8D%E4%B9%A0"><span class="nav-number">1.2.</span> <span class="nav-text">复习</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8B%86%E7%82%B8%E5%BC%B9"><span class="nav-number">1.3.</span> <span class="nav-text">拆炸弹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#phase-1"><span class="nav-number">1.3.1.</span> <span class="nav-text">phase_1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#phase-2"><span class="nav-number">1.3.2.</span> <span class="nav-text">phase_2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#phase-3"><span class="nav-number">1.3.3.</span> <span class="nav-text">phase_3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#phase-4"><span class="nav-number">1.3.4.</span> <span class="nav-text">phase_4</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#phase-5"><span class="nav-number">1.3.5.</span> <span class="nav-text">phase_5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#phase-6"><span class="nav-number">1.3.6.</span> <span class="nav-text">phase_6</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#continue%E2%80%A6"><span class="nav-number">1.3.7.</span> <span class="nav-text">continue…</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Huang Jinhong</p>
  <div class="site-description" itemprop="description">“我们来到这世上是为的是看太阳”</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/duilec" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;duilec" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.cnblogs.com/duile" title="博客园 → https:&#x2F;&#x2F;www.cnblogs.com&#x2F;duile" rel="noopener" target="_blank"><i class="fab fa-cnblog fa-fw"></i>博客园</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Huang Jinhong</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"fflLscOo9DyB8Fx8ubGOzkl5-MdYXbMMI","app_key":"RrGHmVsgcizeqfrfsKcX4Sko","server_url":null,"security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'fflLscOo9DyB8Fx8ubGOzkl5-MdYXbMMI',
      appKey     : 'RrGHmVsgcizeqfrfsKcX4Sko',
      placeholder: "发表评论",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
